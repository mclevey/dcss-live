<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>27&nbsp; Diffusion – Doing Computational Social Science&lt;br&gt;[The **Continuous Development** Edition]{.small}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./28-artificial-neural-networks-fnn-rnn-cnn.html" rel="next">
<link href="./26-complex-adaptive-systems.html" rel="prev">
<link href="./figures/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./20-linear-regression.html">Generative Modeling</a></li><li class="breadcrumb-item"><a href="./27-developing-agent-based-models.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Diffusion</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./figures/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Doing Computational Social Science<br><span class="small">The <strong>Continuous Development</strong> Edition</span></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/UWNETLAB/dcss_supplementary/tree/master/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">👋 Hello!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Learning to Do Computational Social Science</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Research Computing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-python-101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-python-102.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Python 102</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Obtaining Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-sampling-and-survey-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Sampling and survey data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-web-data-apis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Web data (APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-web-data-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Web data (Scraping)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-audio-image-and-document-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Audio, image, and document data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Exploring Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-processing-structured-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Processing Structured Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-exploratory-data-analysis-and-visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory data analysis and visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-association-and-latent-factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Association and latent factors</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-text-as-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Text as Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-text-similarity-and-latent-semantic-space.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Text similarity and latent semantic space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-social-networks-and-relational-thinking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Networks: Relationships as Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-structural-similarity-and-latent-social-space.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Structural similarity and latent social space</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Prediction and Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-machine-and-statistical-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Machine Learning 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-prediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Probability 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./18-credibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Credibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./19-causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Causality</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Generative Modeling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./20-linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Bayesian Regression Models with Probabilistic Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21-multilevel-regression-with-post-stratification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Multilevel regression with post-stratification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22-generalized-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./23-causal-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Causal analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./24-latent-structure-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Latent structure in networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./25-latent-topics-text-lda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Latent topics in text (LDA)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./26-complex-adaptive-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Agent-based Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./27-developing-agent-based-models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Diffusion</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Deep Learning Demystified</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./28-artificial-neural-networks-fnn-rnn-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Neural networks 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./29-processing-natural-language-data-spacy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Processing Natural Language Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./30-transformers-self-attention.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Transformers, Self-attention architecture</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31-latent-topics-text-transformers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Modelling latent topics (Transformers)</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Professional Responsibilities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32-research-ethics-politics-and-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Research Ethics, Politics, and Practices</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33-next-steps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Next steps</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Acknowledgements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./changelog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Changelog</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-centrality-formulas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Centrality Formulas</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix-courses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Courses and Workshops</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#gesis" id="toc-gesis" class="nav-link active" data-scroll-target="#gesis"><span class="header-section-number">28</span> GESIS</a></li>
  <li><a href="#simulation-and-agent-based-modelling" id="toc-simulation-and-agent-based-modelling" class="nav-link" data-scroll-target="#simulation-and-agent-based-modelling"><span class="header-section-number">29</span> Simulation and Agent-based Modelling</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives"><span class="header-section-number">29.1</span> Learning Objectives</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">29.2</span> Setup</a></li>
  <li><a href="#load-and-configure-the-models" id="toc-load-and-configure-the-models" class="nav-link" data-scroll-target="#load-and-configure-the-models"><span class="header-section-number">29.3</span> Load and Configure the Model(s)</a>
  <ul class="collapse">
  <li><a href="#model-1-sir-model-with-high-transmissibility" id="toc-model-1-sir-model-with-high-transmissibility" class="nav-link" data-scroll-target="#model-1-sir-model-with-high-transmissibility"><span class="header-section-number">29.3.1</span> Model 1: SIR Model with High Transmissibility</a></li>
  <li><a href="#model-2-sir-model-with-low-transmissibility" id="toc-model-2-sir-model-with-low-transmissibility" class="nav-link" data-scroll-target="#model-2-sir-model-with-low-transmissibility"><span class="header-section-number">29.3.2</span> Model 2: SIR Model with Low Transmissibility</a></li>
  <li><a href="#comparing-the-two-models" id="toc-comparing-the-two-models" class="nav-link" data-scroll-target="#comparing-the-two-models"><span class="header-section-number">29.3.3</span> Comparing the Two Models</a></li>
  <li><a href="#analyzing-agent-interactions" id="toc-analyzing-agent-interactions" class="nav-link" data-scroll-target="#analyzing-agent-interactions"><span class="header-section-number">29.3.4</span> Analyzing Agent Interactions</a></li>
  </ul></li>
  <li><a href="#model-analysis" id="toc-model-analysis" class="nav-link" data-scroll-target="#model-analysis"><span class="header-section-number">29.4</span> Model Analysis</a></li>
  <li><a href="#sensitivity-analysis-peak-proportion-infected" id="toc-sensitivity-analysis-peak-proportion-infected" class="nav-link" data-scroll-target="#sensitivity-analysis-peak-proportion-infected"><span class="header-section-number">29.5</span> Sensitivity Analysis: Peak Proportion Infected</a>
  <ul class="collapse">
  <li><a href="#correlate-the-parameters-with-the-outcomes" id="toc-correlate-the-parameters-with-the-outcomes" class="nav-link" data-scroll-target="#correlate-the-parameters-with-the-outcomes"><span class="header-section-number">29.5.1</span> Correlate the Parameters with the Outcomes</a></li>
  </ul></li>
  <li><a href="#sensitivity-analysis-time-to-peak-proportion-infected" id="toc-sensitivity-analysis-time-to-peak-proportion-infected" class="nav-link" data-scroll-target="#sensitivity-analysis-time-to-peak-proportion-infected"><span class="header-section-number">29.6</span> Sensitivity Analysis: Time to Peak Proportion Infected</a></li>
  </ul></li>
  <li><a href="#social-learning-influence-and-opinion-dynamics" id="toc-social-learning-influence-and-opinion-dynamics" class="nav-link" data-scroll-target="#social-learning-influence-and-opinion-dynamics"><span class="header-section-number">30</span> Social Learning, Influence, and Opinion Dynamics</a>
  <ul class="collapse">
  <li><a href="#bounded-confidence-models" id="toc-bounded-confidence-models" class="nav-link" data-scroll-target="#bounded-confidence-models"><span class="header-section-number">30.1</span> Bounded Confidence Models</a>
  <ul class="collapse">
  <li><a href="#run-the-model-collect-data" id="toc-run-the-model-collect-data" class="nav-link" data-scroll-target="#run-the-model-collect-data"><span class="header-section-number">30.1.1</span> Run the Model &amp; Collect Data</a></li>
  <li><a href="#plot-opinion-distributions" id="toc-plot-opinion-distributions" class="nav-link" data-scroll-target="#plot-opinion-distributions"><span class="header-section-number">30.1.2</span> Plot Opinion Distributions</a></li>
  <li><a href="#plot-opinions-over-time" id="toc-plot-opinions-over-time" class="nav-link" data-scroll-target="#plot-opinions-over-time"><span class="header-section-number">30.1.3</span> Plot Opinions Over Time</a></li>
  <li><a href="#experimenting-with-epsilon" id="toc-experimenting-with-epsilon" class="nav-link" data-scroll-target="#experimenting-with-epsilon"><span class="header-section-number">30.1.4</span> Experimenting with <span class="math inline">\(\epsilon\)</span></a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">31</span> Conclusion</a></li>
  <li><a href="#going-viral-modelling-the-epidemic-spread-of-simple-contagions" id="toc-going-viral-modelling-the-epidemic-spread-of-simple-contagions" class="nav-link" data-scroll-target="#going-viral-modelling-the-epidemic-spread-of-simple-contagions"><span class="header-section-number">32</span> Going Viral: Modelling the Epidemic Spread of Simple Contagions</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-1" id="toc-learning-objectives-1" class="nav-link" data-scroll-target="#learning-objectives-1"><span class="header-section-number">32.1</span> LEARNING OBJECTIVES</a></li>
  <li><a href="#learning-materials" id="toc-learning-materials" class="nav-link" data-scroll-target="#learning-materials"><span class="header-section-number">32.2</span> LEARNING MATERIALS</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction"><span class="header-section-number">32.3</span> INTRODUCTION</a></li>
  <li><a href="#epidemic-spread-and-diffusion" id="toc-epidemic-spread-and-diffusion" class="nav-link" data-scroll-target="#epidemic-spread-and-diffusion"><span class="header-section-number">32.4</span> EPIDEMIC SPREAD AND DIFFUSION</a></li>
  <li><a href="#modelling-spreading-processes-with-ndlib" id="toc-modelling-spreading-processes-with-ndlib" class="nav-link" data-scroll-target="#modelling-spreading-processes-with-ndlib"><span class="header-section-number">32.5</span> MODELLING SPREADING PROCESSES WITH NDLIB</a>
  <ul class="collapse">
  <li><a href="#simple-contagions-beyond-your-neighborhood" id="toc-simple-contagions-beyond-your-neighborhood" class="nav-link" data-scroll-target="#simple-contagions-beyond-your-neighborhood"><span class="header-section-number">32.5.1</span> Simple Contagions, Beyond Your Neighborhood</a></li>
  <li><a href="#imports" id="toc-imports" class="nav-link" data-scroll-target="#imports"><span class="header-section-number">32.5.2</span> Imports</a></li>
  <li><a href="#simulating-a-small-world" id="toc-simulating-a-small-world" class="nav-link" data-scroll-target="#simulating-a-small-world"><span class="header-section-number">32.5.3</span> Simulating a Small World</a></li>
  </ul></li>
  <li><a href="#simple-contagions-and-epidemic-spread" id="toc-simple-contagions-and-epidemic-spread" class="nav-link" data-scroll-target="#simple-contagions-and-epidemic-spread"><span class="header-section-number">32.6</span> SIMPLE CONTAGIONS AND EPIDEMIC SPREAD</a>
  <ul class="collapse">
  <li><a href="#the-sir-model" id="toc-the-sir-model" class="nav-link" data-scroll-target="#the-sir-model"><span class="header-section-number">32.6.1</span> The SIR Model</a></li>
  <li><a href="#from-simulated-societies-to-denmark" id="toc-from-simulated-societies-to-denmark" class="nav-link" data-scroll-target="#from-simulated-societies-to-denmark"><span class="header-section-number">32.6.2</span> From Simulated Societies to Denmark</a></li>
  <li><a href="#simple-contagions-on-dynamic-networks" id="toc-simple-contagions-on-dynamic-networks" class="nav-link" data-scroll-target="#simple-contagions-on-dynamic-networks"><span class="header-section-number">32.6.3</span> Simple Contagions on Dynamic Networks</a></li>
  </ul></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1"><span class="header-section-number">32.7</span> CONCLUSION</a>
  <ul class="collapse">
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points"><span class="header-section-number">32.7.1</span> Key Points</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#not-so-fast-modelling-the-diffusion-of-complex-contagions" id="toc-not-so-fast-modelling-the-diffusion-of-complex-contagions" class="nav-link" data-scroll-target="#not-so-fast-modelling-the-diffusion-of-complex-contagions"><span class="header-section-number">33</span> Not so Fast: Modelling the Diffusion of Complex Contagions</a>
  <ul class="collapse">
  <li><a href="#learning-objectives-2" id="toc-learning-objectives-2" class="nav-link" data-scroll-target="#learning-objectives-2"><span class="header-section-number">33.1</span> LEARNING OBJECTIVES</a></li>
  <li><a href="#learning-materials-1" id="toc-learning-materials-1" class="nav-link" data-scroll-target="#learning-materials-1"><span class="header-section-number">33.2</span> LEARNING MATERIALS</a></li>
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1"><span class="header-section-number">33.3</span> INTRODUCTION</a></li>
  <li><a href="#from-simple-to-complex-contagions" id="toc-from-simple-to-complex-contagions" class="nav-link" data-scroll-target="#from-simple-to-complex-contagions"><span class="header-section-number">33.4</span> FROM SIMPLE TO COMPLEX CONTAGIONS</a></li>
  <li><a href="#beyond-local-neighborhoods-network-effects-and-thresholds" id="toc-beyond-local-neighborhoods-network-effects-and-thresholds" class="nav-link" data-scroll-target="#beyond-local-neighborhoods-network-effects-and-thresholds"><span class="header-section-number">33.5</span> BEYOND LOCAL NEIGHBORHOODS: NETWORK EFFECTS AND THRESHOLDS</a>
  <ul class="collapse">
  <li><a href="#complex-contagions-narrow-bridges-wide-bridges-and-thresholds" id="toc-complex-contagions-narrow-bridges-wide-bridges-and-thresholds" class="nav-link" data-scroll-target="#complex-contagions-narrow-bridges-wide-bridges-and-thresholds"><span class="header-section-number">33.5.1</span> Complex Contagions, Narrow Bridges, Wide Bridges and Thresholds</a></li>
  </ul></li>
  <li><a href="#threshold-models-for-complex-contagions" id="toc-threshold-models-for-complex-contagions" class="nav-link" data-scroll-target="#threshold-models-for-complex-contagions"><span class="header-section-number">33.6</span> THRESHOLD MODELS FOR COMPLEX CONTAGIONS</a>
  <ul class="collapse">
  <li><a href="#imports-1" id="toc-imports-1" class="nav-link" data-scroll-target="#imports-1"><span class="header-section-number">33.6.1</span> Imports</a></li>
  <li><a href="#complex-contagions-with-variable-thresholds" id="toc-complex-contagions-with-variable-thresholds" class="nav-link" data-scroll-target="#complex-contagions-with-variable-thresholds"><span class="header-section-number">33.6.2</span> Complex Contagions with Variable Thresholds</a></li>
  <li><a href="#towards-greater-realism-stochastic-thresholds-and-network-diffusion-experiments" id="toc-towards-greater-realism-stochastic-thresholds-and-network-diffusion-experiments" class="nav-link" data-scroll-target="#towards-greater-realism-stochastic-thresholds-and-network-diffusion-experiments"><span class="header-section-number">33.6.3</span> Towards Greater Realism: Stochastic Thresholds and Network Diffusion Experiments</a></li>
  </ul></li>
  <li><a href="#conclusion-2" id="toc-conclusion-2" class="nav-link" data-scroll-target="#conclusion-2"><span class="header-section-number">33.7</span> CONCLUSION</a>
  <ul class="collapse">
  <li><a href="#key-points-1" id="toc-key-points-1" class="nav-link" data-scroll-target="#key-points-1"><span class="header-section-number">33.7.1</span> Key Points</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#cultural-cognition-and-opinion-dynamics" id="toc-cultural-cognition-and-opinion-dynamics" class="nav-link" data-scroll-target="#cultural-cognition-and-opinion-dynamics"><span class="header-section-number">34</span> Cultural cognition and opinion dynamics</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/UWNETLAB/dcss_supplementary/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./20-linear-regression.html">Generative Modeling</a></li><li class="breadcrumb-item"><a href="./27-developing-agent-based-models.html"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Diffusion</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Diffusion</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li>Two chapters to be integrated</li>
<li>GESIS</li>
</ul>
<section id="gesis" class="level1" data-number="28">
<h1 data-number="28"><span class="header-section-number">28</span> GESIS</h1>
</section>
<section id="simulation-and-agent-based-modelling" class="level1" data-number="29">
<h1 data-number="29"><span class="header-section-number">29</span> Simulation and Agent-based Modelling</h1>
<p>This notebook accompanies the recorded lecture on “Simulation and Agent-based Modelling.” It’s intended to provide you with a hands-on experience in building and analyzing agent-based models using Python.</p>
<section id="learning-objectives" class="level2" data-number="29.1">
<h2 data-number="29.1" class="anchored" data-anchor-id="learning-objectives"><span class="header-section-number">29.1</span> Learning Objectives</h2>
<p>By the end of this workshop, you will be able to:</p>
<ol type="1">
<li>Understand the basic concepts and components of agent-based modeling.</li>
<li>Implement a simple SIR model using Mesa, a Python library for agent-based modeling.
<ul>
<li>In this notebook, this is done via the course package <code>icsspy</code>, but the models we load here are the same ones I developed in the lecture.</li>
</ul></li>
<li>Analyze the behavior of the SIR model under different conditions and parameters.</li>
<li>Explore a Bounded Confidence Model to understand opinion dynamics.</li>
<li>Conduct sensitivity analysis and parameter sweeps to systematically investigate model behavior.</li>
</ol>
</section>
<section id="setup" class="level2" data-number="29.2">
<h2 data-number="29.2" class="anchored" data-anchor-id="setup"><span class="header-section-number">29.2</span> Setup</h2>
<p>Let’s start by importing the necessary packages and configuring our environment.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mesa</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa.batchrunner <span class="im">import</span> batch_run</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> icsspy</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>icsspy.set_style()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> icsspy.networks <span class="im">import</span> plot_line_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="load-and-configure-the-models" class="level2" data-number="29.3">
<h2 data-number="29.3" class="anchored" data-anchor-id="load-and-configure-the-models"><span class="header-section-number">29.3</span> Load and Configure the Model(s)</h2>
<p>We’ll begin by exploring a classic Susceptible-Infected-Recovered (SIR) model. This model is often used to simulate the spread of infectious diseases.</p>
<section id="model-1-sir-model-with-high-transmissibility" class="level3" data-number="29.3.1">
<h3 data-number="29.3.1" class="anchored" data-anchor-id="model-1-sir-model-with-high-transmissibility"><span class="header-section-number">29.3.1</span> Model 1: SIR Model with High Transmissibility</h3>
<p>First, let’s load the SIRModel class from the course package and define the parameters for our first model, which simulates a disease with a high infection rate.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> icsspy.abms.sir <span class="im">import</span> SIRModel</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>model_1_params <span class="op">=</span> {<span class="st">'N'</span>: <span class="dv">100</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_height'</span>: <span class="dv">40</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_width'</span>: <span class="dv">40</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'infection_rate'</span>: <span class="fl">0.3</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'max_agent_step_size'</span>: <span class="dv">1</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_initial_infections'</span>: <span class="dv">2</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_iterations'</span>: <span class="dv">150</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'recovery_time_range'</span>: [<span class="dv">14</span>, <span class="dv">24</span>]</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Model 1 Params</span><span class="ch">\n</span><span class="st">"</span>, model_1_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, we have a population of 100 agents on a 40x40 grid. The infection rate is set to 0.3, meaning there’s a 30% chance that a susceptible agent will become infected when in contact with an infected agent. The agents can move to adjacent cells, and their recovery time is randomly chosen between 14 and 24 time steps.</p>
<p>Now, let’s run the model and store the results.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>model_1 <span class="op">=</span> SIRModel(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    n_initial_infections <span class="op">=</span> model_1_params[<span class="st">'n_initial_infections'</span>],</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    grid_width <span class="op">=</span> model_1_params[<span class="st">'grid_width'</span>],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    grid_height <span class="op">=</span> model_1_params[<span class="st">'grid_height'</span>],</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> model_1_params[<span class="st">'N'</span>],</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    infection_rate <span class="op">=</span> model_1_params[<span class="st">'infection_rate'</span>],</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    recovery_time_range <span class="op">=</span> model_1_params[<span class="st">'recovery_time_range'</span>],</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    max_agent_step_size <span class="op">=</span> model_1_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_1_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    model_1.step()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>m1res <span class="op">=</span> model_1.datacollector.get_model_vars_dataframe()</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>m1res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-2-sir-model-with-low-transmissibility" class="level3" data-number="29.3.2">
<h3 data-number="29.3.2" class="anchored" data-anchor-id="model-2-sir-model-with-low-transmissibility"><span class="header-section-number">29.3.2</span> Model 2: SIR Model with Low Transmissibility</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model_2_params <span class="op">=</span> {<span class="st">'N'</span>: <span class="dv">100</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_height'</span>: <span class="dv">40</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_width'</span>: <span class="dv">40</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'infection_rate'</span>: <span class="fl">0.15</span>,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'max_agent_step_size'</span>: <span class="dv">1</span>,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_initial_infections'</span>: <span class="dv">2</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_iterations'</span>: <span class="dv">150</span>,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'recovery_time_range'</span>: [<span class="dv">14</span>, <span class="dv">24</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Model 2 Params</span><span class="ch">\n</span><span class="st">"</span>, model_2_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have kept most of the parameters the same as in Model 1, except for the infection rate, which is now 0.15, to simulate a less contagious disease.</p>
<p>Now, let’s run Model 2.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model_2 <span class="op">=</span> SIRModel(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    n_initial_infections <span class="op">=</span> model_2_params[<span class="st">'n_initial_infections'</span>],</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    grid_width <span class="op">=</span> model_2_params[<span class="st">'grid_width'</span>],</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    grid_height <span class="op">=</span> model_2_params[<span class="st">'grid_height'</span>],</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> model_2_params[<span class="st">'N'</span>],</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    infection_rate <span class="op">=</span> model_2_params[<span class="st">'infection_rate'</span>],</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    recovery_time_range <span class="op">=</span> model_2_params[<span class="st">'recovery_time_range'</span>],</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    max_agent_step_size <span class="op">=</span> model_2_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_2_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    model_2.step()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>m2res <span class="op">=</span> model_2.datacollector.get_model_vars_dataframe()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>m2res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="comparing-the-two-models" class="level3" data-number="29.3.3">
<h3 data-number="29.3.3" class="anchored" data-anchor-id="comparing-the-two-models"><span class="header-section-number">29.3.3</span> Comparing the Two Models</h3>
<p>Let’s compare the infection curves from both models to see how the different infection rates affect the spread of the disease.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ax.plot(m1res[<span class="st">'Infected'</span>], label<span class="op">=</span><span class="vs">r'High transmissibility, $\beta$=0.3'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>ax.plot(m2res[<span class="st">'Infected'</span>], label<span class="op">=</span><span class="vs">r'Low transmissibility $\beta$=0.15'</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Discrete Steps in Time"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Proportion Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'upper right'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/sir_compare_models_1-2.png'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="analyzing-agent-interactions" class="level3" data-number="29.3.4">
<h3 data-number="29.3.4" class="anchored" data-anchor-id="analyzing-agent-interactions"><span class="header-section-number">29.3.4</span> Analyzing Agent Interactions</h3>
<p>In addition to tracking the number of infected agents, it’s also useful to analyze how agents interact with each other during the simulation.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>interaction_graphs <span class="op">=</span> {}</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>interaction_graph_summaries <span class="op">=</span> {}</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [model_1, model_2]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, model <span class="kw">in</span> <span class="bu">enumerate</span>(models, start<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    wel <span class="op">=</span> []</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> agent <span class="kw">in</span> model.schedule.agents:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> k, v <span class="kw">in</span> agent.interactions.items():</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            wel.append((<span class="bu">int</span>(agent.unique_id), k, v))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> nx.Graph()</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    G.add_weighted_edges_from(wel)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    interaction_graphs[<span class="ss">f'M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> G</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    avg_degree <span class="op">=</span> <span class="bu">round</span>(<span class="bu">sum</span>(<span class="bu">dict</span>(G.degree()).values()) <span class="op">/</span> <span class="bu">float</span>(G.number_of_nodes()), <span class="dv">2</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    interaction_graph_summaries[<span class="ss">f'M</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (G.number_of_nodes(), G.number_of_edges(), avg_degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>interaction_graph_summaries <span class="op">=</span> pd.DataFrame(interaction_graph_summaries).T</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>interaction_graph_summaries.columns <span class="op">=</span> [<span class="st">'No. Nodes'</span>, <span class="st">'No. Edges'</span>, <span class="st">'Avg. Degree'</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>interaction_graph_summaries</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty graph</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> interaction_graphs[<span class="st">'M2'</span>]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> [d[<span class="st">'weight'</span>] <span class="cf">for</span> u, v, d <span class="kw">in</span> G.edges(data<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>sns.ecdfplot(weights)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Interaction Weight'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'ECDF'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'ECDF of Interaction Weights'</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/compare_agent_networks.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="model-analysis" class="level2" data-number="29.4">
<h2 data-number="29.4" class="anchored" data-anchor-id="model-analysis"><span class="header-section-number">29.4</span> Model Analysis</h2>
<p>So far we have not been very systematic in how we’ve approaches analyzing the outputs of our SIR model. What’s involved in more systematic analyses?</p>
<p>The primary goal of analyzing an agent-based model is to gain insights into how the model behaves and how well it represents the real-world system it’s designed to simulate. This involves understanding the dynamics of the model, validating it against empirical data, and exploring the implications of different parameter settings.</p>
<p>When iteratively analyzing models, we can use Sensitivity Analysis, Parameter Sweeps, and Computational Experiments to understand, test, and analyze the behavior of the model under various conditions. These methods are essential for ensuring the model’s reliability and for interpreting its results.</p>
</section>
<section id="sensitivity-analysis-peak-proportion-infected" class="level2" data-number="29.5">
<h2 data-number="29.5" class="anchored" data-anchor-id="sensitivity-analysis-peak-proportion-infected"><span class="header-section-number">29.5</span> Sensitivity Analysis: Peak Proportion Infected</h2>
<p>Sensitivity Analysis: Peak Proportion Infected Sensitivity analysis helps determine how changes in model parameters affect the outcomes. Here, we’ll focus on the peak proportion of infected agents as our outcome of interest.</p>
<p>First, let’s set up a parameter sweep for the sensitivity analysis.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"N"</span>: <span class="dv">100</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"grid_height"</span>: <span class="dv">40</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"grid_width"</span>: <span class="dv">40</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"infection_rate"</span>: [<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>,],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"recovery_time_range"</span>: [(<span class="dv">7</span>,<span class="dv">14</span>), (<span class="dv">14</span>,<span class="dv">24</span>)],</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"max_agent_step_size"</span>: [<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">12</span>],</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"n_initial_infections"</span>: [<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we can run multiple mpdels for every combination of parameters using the batch_run() function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> mesa.batch_run(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    model_cls<span class="op">=</span>SIRModel,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    parameters<span class="op">=</span>params,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    iterations<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    max_steps<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    number_processes<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    data_collection_period<span class="op">=</span><span class="dv">1</span>,  <span class="co"># collect data at every step</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    display_progress<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>results_df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>results_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s create a small multiples plot to compare some high-level patterns across different parameter settings.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>melted_df <span class="op">=</span> pd.melt(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    results_df,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># include 'RunId' to differentiate runs</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'n_initial_infections'</span>, <span class="st">'infection_rate'</span>, <span class="st">'Step'</span>, <span class="st">'RunId'</span>],</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    value_vars<span class="op">=</span>[<span class="st">'Susceptible'</span>, <span class="st">'Infected'</span>, <span class="st">'Recovered'</span>],</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">'State'</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'Proportion'</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create the FacetGrid</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.FacetGrid(</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    melted_df, col<span class="op">=</span><span class="st">"n_initial_infections"</span>, hue<span class="op">=</span><span class="st">"State"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">3</span>, height<span class="op">=</span><span class="dv">4</span>, aspect<span class="op">=</span><span class="fl">1.5</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># map the scatterplot for individual observations</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    sns.scatterplot, x<span class="op">=</span><span class="st">'Step'</span>, y<span class="op">=</span><span class="st">'Proportion'</span>, alpha<span class="op">=</span><span class="fl">0.005</span>, edgecolor<span class="op">=</span><span class="va">None</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># map the lineplot for aggregated data</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>g.map_dataframe(</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    sns.lineplot, x<span class="op">=</span><span class="st">'Step'</span>, y<span class="op">=</span><span class="st">'Proportion'</span>, linewidth<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>g.add_legend()</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"Time Step"</span>, <span class="st">"Proportion"</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>g.set_titles(<span class="st">"Initial Infections: </span><span class="sc">{col_name}</span><span class="st">"</span>)</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"images/sir_subplots.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sir_subplots.png" class="img-fluid figure-img"></p>
<figcaption>Batch results for Model 2 with mean trends emphasized.</figcaption>
</figure>
</div>
<p>Next, we aggreate the results for the sensitivity analysis.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>aggregated_results <span class="op">=</span> results_df.groupby([<span class="st">"RunId"</span>, <span class="st">"infection_rate"</span>, <span class="st">"recovery_time_range"</span>, <span class="st">"max_agent_step_size"</span>, <span class="st">"n_initial_infections"</span>]).agg(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    peak_infected<span class="op">=</span>(<span class="st">"Infected"</span>, <span class="st">"max"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>).reset_index()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>aggregated_results.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s plot the sensitivity analysis results. We’ll need to convert the <code>recovery_time_range</code> tuples into strings first.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>aggregated_results[<span class="st">'recovery_time_range_str'</span>] <span class="op">=</span> aggregated_results[<span class="st">'recovery_time_range'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">-</span><span class="sc">{</span>x[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And then we can set up the plot.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># infection rate</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"infection_rate"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(a) Sensitivity to Infection Rate"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Infection Rate"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># recovery time range (use the string version we just created)</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"recovery_time_range_str"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(b) Sensitivity to Recovery Time Range"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Recovery Time Range"</span>)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># max agent step size</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"max_agent_step_size"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(c) Sensitivity to Max Agent Step Size"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Max Agent Step Size"</span>)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co"># initial infections</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"n_initial_infections"</span>, y<span class="op">=</span><span class="st">"peak_infected"</span>, data<span class="op">=</span>aggregated_results)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(d) Sensitivity to Initial Infections"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Initial Infections"</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Peak Infected</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"images/sir_sensitivity_analysis.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sir_sensitivity_analysis.png" class="img-fluid figure-img"></p>
<figcaption>Sensitivity plot for our SIR model parameters and peak proportion infected across all model runs.</figcaption>
</figure>
</div>
<section id="correlate-the-parameters-with-the-outcomes" class="level3" data-number="29.5.1">
<h3 data-number="29.5.1" class="anchored" data-anchor-id="correlate-the-parameters-with-the-outcomes"><span class="header-section-number">29.5.1</span> Correlate the Parameters with the Outcomes</h3>
<p>As an additional step, we can correlate our parameters with the peak proportion infected to get a sense of the relative influence of each parameter. To do so, we have to transform the recovery time ranges into a single number. There are a few ways we could do this, but to keep things simple we’ll take the mean of the two values.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>aggregated_results[<span class="st">"recovery_time_range_numeric"</span>] <span class="op">=</span> aggregated_results[<span class="st">"recovery_time_range"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">sum</span>(x) <span class="op">/</span> <span class="bu">len</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once we’ve done that, we’ll drop the original tuple (<code>recovery_time_range</code>) and it’s string representation (<code>recovery_time_range_str</code>). I’ll create a new dataframe for these modifications, since we’ll use the dropped variables in our second sensitivity analysis.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>aggregated_results_4corr <span class="op">=</span> aggregated_results.copy()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>aggregated_results_4corr.drop([<span class="st">'recovery_time_range'</span>, <span class="st">'recovery_time_range_str'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And now we can correlate!</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> aggregated_results_4corr.corr()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>peak_infected_correlations <span class="op">=</span> correlation_matrix[<span class="st">"peak_infected"</span>].drop(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"peak_infected"</span>, <span class="st">"RunId"</span>]</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s visualize the correlations using a line comparison plot.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>for_plotting <span class="op">=</span> {}</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> parameter, correlation <span class="kw">in</span> <span class="bu">zip</span>(peak_infected_correlations.index, peak_infected_correlations.values):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    for_plotting[parameter] <span class="op">=</span> <span class="bu">round</span>(correlation, <span class="dv">4</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>plot_line_comparison(</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    for_plotting,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">xrange</span><span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="co"># all positive correlations</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    print_decimals<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">""</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">'</span><span class="ch">\n</span><span class="st">Correlations between model parameters and peak infection.'</span>,</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    filename<span class="op">=</span><span class="st">"images/sir_correlations_params_peak_infection.png"</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="sensitivity-analysis-time-to-peak-proportion-infected" class="level2" data-number="29.6">
<h2 data-number="29.6" class="anchored" data-anchor-id="sensitivity-analysis-time-to-peak-proportion-infected"><span class="header-section-number">29.6</span> Sensitivity Analysis: Time to Peak Proportion Infected</h2>
<p>Next, let’s analyze how different parameters affect the time it takes for the infection to reach its peak.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>time_to_peak <span class="op">=</span> results_df.loc[results_df.groupby(<span class="st">"RunId"</span>)[<span class="st">"Infected"</span>].idxmax()]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>time_to_peak <span class="op">=</span> time_to_peak[[<span class="st">"RunId"</span>, <span class="st">"Step"</span>, <span class="st">"Infected"</span>]].rename(</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>{<span class="st">"Step"</span>: <span class="st">"time_to_peak"</span>, <span class="st">"Infected"</span>: <span class="st">"peak_infected"</span>}</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>time_to_peak_merged <span class="op">=</span> pd.merge(time_to_peak, aggregated_results, on<span class="op">=</span><span class="st">"RunId"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s visualize how the time to peak infection varies with different parameters.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">12</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Infection rate</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"infection_rate"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(a) Time to Peak Infection vs. Infection Rate"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Infection Rate"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Recovery time range</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"recovery_time_range_str"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(b) Time to Peak Infection vs. Recovery Time Range"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Recovery Time Range"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Max agent step size</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], x<span class="op">=</span><span class="st">"max_agent_step_size"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(c) Time to Peak Infection vs. Max Agent Step Size"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Max Agent Step Size"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial infections</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>sns.boxplot(ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">1</span>], x<span class="op">=</span><span class="st">"n_initial_infections"</span>, y<span class="op">=</span><span class="st">"time_to_peak"</span>, data<span class="op">=</span>time_to_peak_merged)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="st">"</span><span class="ch">\n</span><span class="st">(d) Time to Peak Infection vs. Initial Infections"</span>, loc<span class="op">=</span><span class="st">"left"</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_xlabel(<span class="st">"</span><span class="ch">\n</span><span class="st">Initial Infections"</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_ylabel(<span class="st">"Time to Peak Infection</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"images/sir_time_to_peak_analysis.png"</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There is much more we could do here, but let’s move on to a different example.</p>
</section>
</section>
<section id="social-learning-influence-and-opinion-dynamics" class="level1" data-number="30">
<h1 data-number="30"><span class="header-section-number">30</span> Social Learning, Influence, and Opinion Dynamics</h1>
<ul>
<li>ODD Protocol for Bounded Confidence Model</li>
</ul>
<section id="bounded-confidence-models" class="level2" data-number="30.1">
<h2 data-number="30.1" class="anchored" data-anchor-id="bounded-confidence-models"><span class="header-section-number">30.1</span> Bounded Confidence Models</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa <span class="im">import</span> Agent</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa <span class="im">import</span> Model</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa.space <span class="im">import</span> MultiGrid</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa.time <span class="im">import</span> RandomActivation</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> mesa.datacollection <span class="im">import</span> DataCollector</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yaml</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> icsspy</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>icsspy.set_style()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> icsspy.abms.bounded_confidence <span class="im">import</span> BoundedConfidenceModel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>model_params <span class="op">=</span> {<span class="st">'N'</span>: <span class="dv">100</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'epsilon'</span>: <span class="fl">0.5</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_height'</span>: <span class="dv">40</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'grid_width'</span>: <span class="dv">40</span>,</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'max_agent_step_size'</span>: <span class="dv">1</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'n_iterations'</span>: <span class="dv">1500</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>pprint(model_params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="run-the-model-collect-data" class="level3" data-number="30.1.1">
<h3 data-number="30.1.1" class="anchored" data-anchor-id="run-the-model-collect-data"><span class="header-section-number">30.1.1</span> Run the Model &amp; Collect Data</h3>
<p>Let’s run the model with the parameters we’ve defined and collect the data.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> BoundedConfidenceModel(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    grid_width<span class="op">=</span>model_params[<span class="st">'grid_width'</span>],</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    grid_height<span class="op">=</span>model_params[<span class="st">'grid_height'</span>],</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    N<span class="op">=</span>model_params[<span class="st">'N'</span>],</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    epsilon<span class="op">=</span>model_params[<span class="st">'epsilon'</span>],</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    max_agent_step_size<span class="op">=</span>model_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    model.step()</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> model.datacollector.get_agent_vars_dataframe().reset_index()</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>results.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="plot-opinion-distributions" class="level3" data-number="30.1.2">
<h3 data-number="30.1.2" class="anchored" data-anchor-id="plot-opinion-distributions"><span class="header-section-number">30.1.2</span> Plot Opinion Distributions</h3>
<p>Now, we’ll visualize the evolution of the opinion distribution over time.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> results.groupby(<span class="st">'Step'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, group <span class="kw">in</span> grouped:</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    sns.kdeplot(group[<span class="st">'Opinion'</span>], color<span class="op">=</span><span class="st">'C0'</span>, alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'</span><span class="ch">\n</span><span class="st">Opinion'</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Density</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">"Bounded Confidence Model</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>model_params[<span class="st">'epsilon'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.title(title, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/bounded-confidence-opinion-distribution-evolution.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A collection of KDE plots showing the evolution of the opinion distribution at each time step in the model.</p>
</section>
<section id="plot-opinions-over-time" class="level3" data-number="30.1.3">
<h3 data-number="30.1.3" class="anchored" data-anchor-id="plot-opinions-over-time"><span class="header-section-number">30.1.3</span> Plot Opinions Over Time</h3>
<p>Let’s visualize how opinions change over time for individual agents.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>time_steps <span class="op">=</span> results[<span class="st">'Step'</span>]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>opinions <span class="op">=</span> results[<span class="st">'Opinion'</span>]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>title <span class="op">=</span> <span class="st">"Bounded Confidence Model</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>model_params[<span class="st">'epsilon'</span>]<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>sc <span class="op">=</span> plt.scatter(time_steps, opinions, c<span class="op">=</span>opinions, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, s<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>cbar <span class="op">=</span> plt.colorbar(sc)</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>cbar.set_label(<span class="st">'Opinion'</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Time (Steps)'</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Opinion'</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>plt.title(title, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>plt.xlim(time_steps.<span class="bu">min</span>(), time_steps.<span class="bu">max</span>())</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>plt.ylim(<span class="op">-</span><span class="fl">1.01</span>, <span class="dv">1</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/bounded_confidence_epsilon_one_run.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Three opinion clusters forming over time in a single run of a BCM with <span class="math inline">\(\epsilon\)</span> = 5. Note the center and two extremes.</p>
</section>
<section id="experimenting-with-epsilon" class="level3" data-number="30.1.4">
<h3 data-number="30.1.4" class="anchored" data-anchor-id="experimenting-with-epsilon"><span class="header-section-number">30.1.4</span> Experimenting with <span class="math inline">\(\epsilon\)</span></h3>
<p>Finally, let’s run the simulation with different <span class="math inline">\(\epsilon\)</span> values and compare the results.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_simulation_with_different_epsilons(model_params, epsilon_values):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    all_results <span class="op">=</span> []</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> epsilon <span class="kw">in</span> epsilon_values:</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> BoundedConfidenceModel(</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>            grid_width<span class="op">=</span>model_params[<span class="st">'grid_width'</span>],</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>            grid_height<span class="op">=</span>model_params[<span class="st">'grid_height'</span>],</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            N<span class="op">=</span>model_params[<span class="st">'N'</span>],</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>            epsilon<span class="op">=</span>epsilon,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>            max_agent_step_size<span class="op">=</span>model_params[<span class="st">'max_agent_step_size'</span>],</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(model_params[<span class="st">'n_iterations'</span>]):</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>            model.step()</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>        epsilon_results <span class="op">=</span> model.datacollector.get_agent_vars_dataframe().reset_index()</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        epsilon_results[<span class="st">'Epsilon'</span>] <span class="op">=</span> epsilon  <span class="co"># Add epsilon to track different values</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        all_results.append(epsilon_results)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine all results into a single DataFrame</span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    combined_results <span class="op">=</span> pd.concat(all_results, ignore_index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined_results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s run the model for a range of <span class="math inline">\(\epsilon\)</span> values and then plot the results.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>epsilon_values <span class="op">=</span> [<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="dv">1</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>epsilon_results <span class="op">=</span> run_simulation_with_different_epsilons(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    model_params, epsilon_values</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>epsilon_results.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s create some subplots to compare runs for each of our <span class="math inline">\(\epsilon\)</span> values.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>grouped <span class="op">=</span> epsilon_results.groupby(<span class="st">'Epsilon'</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="dv">11</span>, <span class="dv">1</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">30</span>),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    sharex<span class="op">=</span><span class="va">True</span>, sharey<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    constrained_layout<span class="op">=</span><span class="va">True</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (epsilon, group), ax <span class="kw">in</span> <span class="bu">zip</span>(grouped, axs):</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    time_steps <span class="op">=</span> group[<span class="st">'Step'</span>]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    opinions <span class="op">=</span> group[<span class="st">'Opinion'</span>]</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    sc <span class="op">=</span> ax.scatter(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        time_steps,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>        opinions,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>        c<span class="op">=</span>opinions,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">=</span><span class="st">'coolwarm'</span>,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>        s<span class="op">=</span><span class="dv">10</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    cbar <span class="op">=</span> fig.colorbar(sc, ax<span class="op">=</span>ax)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cbar.set_label('Opinion')</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="vs">r"$\epsilon$"</span> <span class="op">+</span> <span class="ss">f" = </span><span class="sc">{</span>epsilon<span class="sc">}</span><span class="ss">"</span>, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    ax.set_xlim(time_steps.<span class="bu">min</span>(), time_steps.<span class="bu">max</span>())</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    ax.set_ylim(<span class="op">-</span><span class="fl">1.01</span>, <span class="dv">1</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="co"># custom positions for shared x and y labels</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>fig.text(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.01</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Time (Steps)'</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">18</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>fig.text(</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">-</span><span class="fl">0.01</span>, <span class="fl">0.5</span>,</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Opinion'</span>,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>    ha<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    va<span class="op">=</span><span class="st">'center'</span>,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    rotation<span class="op">=</span><span class="st">'vertical'</span>,</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>    fontsize<span class="op">=</span><span class="dv">18</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'output/epsilon_comparison_one_run.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Results of a parameter sweep on <span class="math inline">\(\epsilon\)</span>. Note tendencies towards fragmentation, polarization, and consensus at different <span class="math inline">\(\epsilon\)</span> values.</p>
</section>
</section>
</section>
<section id="conclusion" class="level1" data-number="31">
<h1 data-number="31"><span class="header-section-number">31</span> Conclusion</h1>
<p>We explored the basic components of agent-based models and how to implement them in Python using Mesa and icsspy, aa various techniques for analyzing the results. Through sensitivity analysis and parameter sweeps, we gained insights into how different parameters influence model outcomes.</p>
<p>We’ve just scratched the surface of what’s possible with agent-based models!</p>
</section>
<section id="going-viral-modelling-the-epidemic-spread-of-simple-contagions" class="level1" data-number="32">
<h1 data-number="32"><span class="header-section-number">32</span> Going Viral: Modelling the Epidemic Spread of Simple Contagions</h1>
<ul>
<li>TODO: Use <code>mesa</code> instead of <code>NDLib</code>. Version 3 comes out in October with a stable release to follow shortly thereafter. Note that the jump to 3 breaks backwards compatibility. Hold off on this change for now.</li>
</ul>
<section id="learning-objectives-1" class="level2" data-number="32.1">
<h2 data-number="32.1" class="anchored" data-anchor-id="learning-objectives-1"><span class="header-section-number">32.1</span> LEARNING OBJECTIVES</h2>
<ul>
<li>Explain what simple contagions are</li>
<li>Describe processes / mechanisms that enable simple contagions to spread rapidly via network connections</li>
<li>Configure an agent-based simulation of the spread of simple contagions through social networks using the Python package NDLib</li>
<li>Interpret aggregate results produced by many different executions of a simulation model</li>
<li>Explain the basic idea of a SIR model, and describe how network-based SIR models deviate from SIR models based on differential equations</li>
<li>Execute a simulation model on empirical network data, both cross-sectional and dynamic</li>
</ul>
</section>
<section id="learning-materials" class="level2" data-number="32.2">
<h2 data-number="32.2" class="anchored" data-anchor-id="learning-materials"><span class="header-section-number">32.2</span> LEARNING MATERIALS</h2>
<p>You can find the online learning materials for this chapter in <code>doing_computational_social_science/Chapter_17</code>. <code>cd</code> into the directory and launch your Jupyter Server.</p>
</section>
<section id="introduction" class="level2" data-number="32.3">
<h2 data-number="32.3" class="anchored" data-anchor-id="introduction"><span class="header-section-number">32.3</span> INTRODUCTION</h2>
<p>In this chapter, we will explore another aspect of social network analysis with an emphasis on modelling the spread of contagions over networks to better understand network structure. In previous chapters on networks, I emphasized the idea that network structures govern the spread of various kinds of things, such as infectious diseases, information, beliefs, and behaviours. In this chapter, we will dig deeper into theory, methods, and models that can help us understand how such contagions spread through networks. We will start by discussing the basics of a network-based approach to diffusion, and will introduce the idea of a “simple contagion,” such as information or an infectious disease. Then I’ll compare and contrast traditional models of epidemic spread with some simple network models and finish by extending our discussion of simple contagions to dynamic networks.</p>
</section>
<section id="epidemic-spread-and-diffusion" class="level2" data-number="32.4">
<h2 data-number="32.4" class="anchored" data-anchor-id="epidemic-spread-and-diffusion"><span class="header-section-number">32.4</span> EPIDEMIC SPREAD AND DIFFUSION</h2>
<p>Scientific approaches to studying the spread of contagions through populations have been developing for well over a century. Epidemiologists have been using mathematical models of disease spread like the SIR model since at least the 1920s <span class="citation" data-cites="kermack1927contribution">(<a href="references.html#ref-kermack1927contribution" role="doc-biblioref">Kermack and McKendrick 1927</a>)</span>. Some of the fundamental ideas behind this particular type of model, which partitions populations into different “compartments” (<strong>S</strong>usceptible, <strong>I</strong>nfected, <strong>R</strong>ecovered/<strong>R</strong>emoved, etc.) and models transitions between them, can even be traced back to models developed by the famous Dutch mathematician Daniel Bernoulli in 1766, which sought to understand the effect that eliminating smallpox would have on life expectency <span class="citation" data-cites="dietz2002daniel">(<a href="references.html#ref-dietz2002daniel" role="doc-biblioref">Dietz and Heesterbeek 2002</a>)</span>.</p>
<p>Traditional epidemiological models make some strong simplifying assumptions. The advent of network analysis has led epidemiologists to incorporate network structure and dynamics into their work to address some of those assumptions. Since it can be <em>incredibly</em> challenging, not to mention costly and time-consuming, to collect the relevant data, these models typically combine observational data with carefully specified simulation models that we can run thousands of times. We can then step back and look at the most common outcomes from these many simulations.</p>
<p>The value of a network approach to questions of diffusion is not limited to epidemiology. Network analysts are interested in the spread of many different kinds of contagions, infectious diseases being only one (important) example. In network analysis, we use the term “<strong>contagion</strong>” to mean some “thing” that spreads through a network; it may be a disease, or perhaps news, a new fashion trend, safe-sex behaviours, or some other quality. Usually, contagions are things that are not consumed as they spread, but propagate and increase in total. A sum of money being shared through a network, for example, is not usually called a contagion, nor is it subject to epidemic spread and diffusion.</p>
<p>To better understand the spread of a contagion through a network, there are some key terms that are important to know. A node is <strong>activated</strong> when they’ve adopted, caught, or been “infected” by whatever contagion is flowing over the network. For example, they might catch a cold or adopt a belief. A node is <strong>exposed</strong> to the contagion when an adjacent node is activated.</p>
<p>Consider the hypothetical network shown in <a href="#fig-16_01" class="quarto-xref">Figure&nbsp;<span>32.1</span></a>, through which an information-based contagion spreads over time. At first (Time 0), Yevgen has some interesting gossip he is eager to share. Since Yevgen and Eric are directly connected, Eric is “exposed.” Once Yevgen shares the information with Eric in Time 1, Eric becomes activated and his alters become exposed. Eric’s switch from exposed to activated is a <strong>state change</strong>. All state changes in the figure are represented by changes in node color from white (not activated, not exposed) to grey (exposed) to activated (crimson).</p>
<p>This is some <em>really</em> interesting gossip, and Eric can hardly contain it. He doesn’t. He shares it with his contacts, triggering another set of state changes in Time 2. Finally, in Time 3, all of Eric’s neighbourhood has been activated and the process continues to spread beyond the boundaries of the figure.</p>
<p><img src="figures/contagion_simple.png" class="img-fluid"></p>
<p>This is an illustration of a <strong>simple contagion</strong> process. It’s “simple” in several respects, the most salient of which is that transmission between any two people is <em>practically effortless</em>. A single interaction between two people is all that is needed to enable a simple contagion like information to spread. This is not just true for informational contagions, of course. Other simple contagions, such as COVID-19 or a sexually transmitted infection, spread with the same sort of ease. And yet we don’t learn new information from every conversation, contract COVID-19 from every face-to-face interaction, or develop an STI following every sexual encounter. And despite having much in common, there are substantial differences in the specific diffusion patterns for these and other simple contagions.</p>
<p>There are two things that are especially important to keep in mind here. First, most contagions are not <em>automatically</em> transmitted after a single exposure. Therefore, we think about these transmission events in a <strong>probabilistic</strong> way rather than a <strong>deterministic</strong> way: each exposures increases the <em>likelihood</em> of activation. The second thing to understand is specifically related to social networks, and it’s another simple idea that turns out to have profound scientific and practical consequences. All contagions are ultimately spread by specific transmission <em>mechanisms</em> like conversation (e.g., informational contagions), being co-present in the same spaces (e.g., COVID-19), and so on. These are <strong>social mechanisms</strong>. There are culturally-specific rules, norms, and conventions that govern how we interact with one another. Of course, we often violate those conventions. Yet, despite individual variation and deviations, the highly-patterned micro-level behaviours are strong enough to generate large-scale social networks that take on different shapes and structural configurations. Once formed, those emergent networks take on something of a life of their own and work in a top-down fashion to structure and constrain what happens at the micro-level, further shaping diffusion dynamics.</p>
<p>Our day-to-day information sharing networks have <em>very</em> different structures than our sexual contact networks; consider the norms and attitudes associated with each. We are all embedded in these and countless other evolving networks at the same time, each defined by a host of factors, sociological and otherwise. So while simple contagions spread through networks in the same way (exposed nodes activate and expose other nodes), there are still a variety of factors that might lead them to spread differently from one another, and understanding these differences is vital. For network structure and processes, this is both a bottom up and a top down process.</p>
<p>These are the two things that matter most for the spread of simple contagions: increased <em>likelihood</em> of transmission based on repeated exposures, and the effects of emergent and evolving network structure on the spread of a contagion as to spreads through ties, activating some but not others. <strong>Complex contagions</strong> behave differently, which we’ll address next chapter.</p>
</section>
<section id="modelling-spreading-processes-with-ndlib" class="level2" data-number="32.5">
<h2 data-number="32.5" class="anchored" data-anchor-id="modelling-spreading-processes-with-ndlib"><span class="header-section-number">32.5</span> MODELLING SPREADING PROCESSES WITH NDLIB</h2>
<p>Understanding network diffusion is not always intuitive, especially when we discuss complex contagions. To lay the foundation for the next chapter, we will begin by modelling simple contagions. The models we are executing in this chapter are agent-based simulations <span class="citation" data-cites="macy2002factors macy2009social epstein2006generative bruch2015agent shaw2019charting shaw2015mechanics">(see <a href="references.html#ref-macy2002factors" role="doc-biblioref">M. W. Macy and Willer 2002</a>; <a href="references.html#ref-macy2009social" role="doc-biblioref">M. Macy and Flache 2009</a>; <a href="references.html#ref-epstein2006generative" role="doc-biblioref">Epstein 2006</a>; <a href="references.html#ref-bruch2015agent" role="doc-biblioref">Bruch and Atwell 2015</a>; <a href="references.html#ref-shaw2019charting" role="doc-biblioref">Shaw 2019</a>, <a href="references.html#ref-shaw2015mechanics" role="doc-biblioref">2015</a>)</span> that unfold over time in a series of discrete steps. This means each node is equipped with some set of simple rules that govern what they can do and how they respond to their local neighbors. In the case of simple contagions, this is generally just a matter of probability of infection when two nodes come into “contact” in the simulation. As the model steps through time, it repeatedly executes those rules, changing each node’s state and next iteration. This process continues for a fixed number of iterations that we determine ourselves, or until no further changes are possible. When the runs are finished, we can step back and look at overall patterns across the many different iterations.</p>
<p>We will use the NDLib package to develop the models <span class="citation" data-cites="rossetti2018ndlib rossetti2017ndlib">(see <a href="references.html#ref-rossetti2018ndlib" role="doc-biblioref">Rossetti et al. 2018</a>, <a href="references.html#ref-rossetti2017ndlib" role="doc-biblioref">2017</a>)</span>. NDLib is built on top of NetworkX and, as of 2021, supports 27 different diffusion models for both simple and complex contagions out of the box. NDLib also contains utilities for specifying custom models from scratch, which gives us a good deal of freedom.</p>
<p>The basic workflow for developing simulation models with NDLib involves:</p>
<ol type="1">
<li>Creating or loading network data in the form of a NetworkX graph object</li>
<li>Selecting and configuring a diffusion model, or creating one from scratch</li>
<li>Executing the simulations</li>
<li>Visualizing the results, interpreting macro-level patterns, and drawing inferences about spreading processes</li>
</ol>
<p>We will execute a several diffusion models, starting with epidemiological SIR models. To develop some intuition of how the modelling process works, we’ll start with a simple model that is based <em>entirely</em> on simulated data. Then, we’ll see how to go from executing a single simulation to executing hundreds, and finally how to execute these models using empirically observed network data.</p>
<p>Next, we’ll turn our attention to threshold models, executed using empirical network data. We will fit a variety of models with slightly different parameters, with a specific emphasis on understanding the effects of using different types of uniform and variable thresholds.</p>
<blockquote class="blockquote">
<p><strong>Further Reading</strong></p>
<p><span class="citation" data-cites="rossetti2018ndlib">Rossetti et al. (<a href="references.html#ref-rossetti2018ndlib" role="doc-biblioref">2018</a>)</span> provide an overview of the design of NDLib. If you want to learn more about network theories of diffusion, I would recommend the first two chapters of Damon Centola’s <span class="citation" data-cites="centola2018behavior">(<a href="references.html#ref-centola2018behavior" role="doc-biblioref">2018</a>)</span> <em>How Behavior Spreads</em> and the first few chapters of Centola’s <span class="citation" data-cites="centola2021change">(<a href="references.html#ref-centola2021change" role="doc-biblioref">2021</a>)</span> <em>Change: How to Make Big Things Happen</em>.</p>
</blockquote>
<section id="simple-contagions-beyond-your-neighborhood" class="level3" data-number="32.5.1">
<h3 data-number="32.5.1" class="anchored" data-anchor-id="simple-contagions-beyond-your-neighborhood"><span class="header-section-number">32.5.1</span> Simple Contagions, Beyond Your Neighborhood</h3>
<p>Since simple contagions can spread with only a single source of exposure, they can “go viral” fairly easily, even if most ultimately do not. Think, for a moment, about the kinds of networks that enable the spread of COVID-19, mass email chains, or internet memes. What are the features of those networks that you would expect to be most relevant? There is, of course, the trivial example of a completely connected network, where every node is connected to every other node, in which case simple contagions can spread with astonishing speed and efficiency. If someone sends a hilarious cat video to everyone on a listserv, then anyone who opens the email will have been activated by the action of a single node. Social networks are <em>very rarely</em> completely connected, however.</p>
<p>We can also think of network effects that are related to differences in how central people are. In Chapter 16, we discussed two betweenness centrality measures: shortest paths and current flow. Nodes with high betweenness centrality are especially important in the transmission of simple contagions because they are disproportionately likely to be the conduit between densely connected clusters of nodes (such as the cohesive subgroups we considered in Chapter 15). Once a simple contagion enters a cohesive subgroup, the members of that group generally become activated <em>very</em> quickly. The more paths that lead into the cluster, the more quickly the process happens, but if the paths are few in number, or if they are rarely used (i.e., <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> talk, but infrequently) then the contagion may never make the leap from one to the other. We’ll see this dynamic in action when we turn to the simulations a bit later in the chapter.</p>
<p>This way of thinking about network effects on information diffusion owes much to Mark Granovetter’s <span class="citation" data-cites="granovetter1973strength">(<a href="references.html#ref-granovetter1973strength" role="doc-biblioref">1973</a>)</span> classic article “The Strength of Weak Ties.” Granovetter, a grad student at the time, was interested in understanding how blue-collar workers in the Boston area got information about job opportunities. He found that the most efficient sources of information were contacts with whom the job-seeker had relatively infrequent contact, and that this was primarily due to the fact that these contacts were not part of the seeker’s usual cluster of friends and family, who tended to have access to the same information. The “<strong>strength of weak ties</strong>” idea, then, is that ties that are <strong>affectively weaker</strong> (i.e., we don’t know them as well and we interact with them less frequently) can be <strong>structurally stronger</strong> because they are a conduit of novel information into our tight clusters of personal ties, within which quite a lot of redundant information circulates. This was an important finding that laid the foundation for much of the research into diffusion that followed, but also serves as a reminder that we should not expect all contagions to act the same.</p>
<p>Several network measures can give us imperfect insights into diffusion processes. One of the simplest is <strong>network diameter</strong>, which is equal to the length of the longest shortest-path in the network. If a contagion is spreading along shortest paths, network diameter will tell us the maximum number of exposures needed to reach the whole network from a given starting node. A network with smaller diameter will likely be more conducive than a similar network with higher diameter. Unfortunately, however, network diameter tells us little to nothing about the network’s overall structure, since it only gives us information about a single path (or multiple equal paths).</p>
<p>Ideally, a network-level measure that could offer insight into how diffusion processes might unfold over time would include more information about the structure of the network <em>in general</em>. Think back to shortest path betweenness centrality for a moment. As we discussed above, nodes with high betweenness centrality are likely to play a very important role in the diffusion of <em>simple</em> contagions through a network because they are efficient routes between distant parts of a network. However, a single node’s betweenness centrality does not give us a good idea of the network’s structural effects on the spread of a simple contagion. Instead, we could calculate the average length of <em>all</em> shortest paths in the network, which would give us a better idea of how easy it is for any one node to reach any other. And since simple contagions spread easily within clusters, a single activated node will expose most or all of a cluster. Given this theoretical knowledge, we could calculate a network’s <strong>clustering coefficient</strong>, which summaries the tendency for nodes to be present within clusters. Higher clustering coefficients indicate that nodes are more likely to be found in closed triplets (triangles), which at a larger scale tends to produce very dense clusters.</p>
<p>Putting these two things together, we could hypothesize that networks that have low average shortest paths and high clustering coefficients are very likely to facilitate the spread of a simple contagion. In fact this is <em>exactly</em> the case, and what we’ve described is known as a <strong>small-world network</strong>, the properties of which were famously exposed by <span class="citation" data-cites="watts1998collective">Watts and Strogatz (<a href="references.html#ref-watts1998collective" role="doc-biblioref">1998</a>)</span>.</p>
</section>
<section id="imports" class="level3" data-number="32.5.2">
<h3 data-number="32.5.2" class="anchored" data-anchor-id="imports"><span class="header-section-number">32.5.2</span> Imports</h3>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ndlib.models.ModelConfig <span class="im">as</span> mc</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ndlib.models.epidemics <span class="im">as</span> ep</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ndlib.utils <span class="im">import</span> multi_runs</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dcss <span class="im">import</span> set_style, download_dataset</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dcss.networks <span class="im">import</span> <span class="op">*</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>set_style()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="simulating-a-small-world" class="level3" data-number="32.5.3">
<h3 data-number="32.5.3" class="anchored" data-anchor-id="simulating-a-small-world"><span class="header-section-number">32.5.3</span> Simulating a Small World</h3>
<p>To get started with modelling diffusion processes, we’ll simulate a simple network with 300 nodes. The particular type of network we are simulating here is a “small world” network, which if you recall from earlier is a type of network with low average shortest paths and high clustering coefficients. Each node in this simulated network, shown in <a href="#fig-16_01" class="quarto-xref">Figure&nbsp;<span>32.1</span></a>, will be connected to 4 other nodes. Obviously this network differs substantially from just about any existing social network that we might observe empirically, but it’s a useful starting point. Once we’ve developed some intuition of the how these types of models work, we’ll switch over to using empirical data on interaction networks.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>population_size <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> nx.watts_strogatz_graph(population_size, <span class="dv">4</span>, <span class="fl">0.15</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>G.name <span class="op">=</span> <span class="st">"A Simulated Small World"</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(G)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>layout <span class="op">=</span> nx.nx_pydot.graphviz_layout(G)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>nx.draw(G,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        pos<span class="op">=</span>layout,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        node_color<span class="op">=</span><span class="st">'gray'</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        edge_color<span class="op">=</span><span class="st">'gray'</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        node_size<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="fl">.5</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_01.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_01" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_01.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_01-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.1: png
</figcaption>
</figure>
</div>
</section>
</section>
<section id="simple-contagions-and-epidemic-spread" class="level2" data-number="32.6">
<h2 data-number="32.6" class="anchored" data-anchor-id="simple-contagions-and-epidemic-spread"><span class="header-section-number">32.6</span> SIMPLE CONTAGIONS AND EPIDEMIC SPREAD</h2>
<p>Let’s start by simulating the spread of a simple contagion through our simulated social network. Since we’ve already constructed our the NetworkX object (<code>G</code>), we can jump straight to the second step of the workflow, which is to configure the parameters for our first model.</p>
<section id="the-sir-model" class="level3" data-number="32.6.1">
<h3 data-number="32.6.1" class="anchored" data-anchor-id="the-sir-model"><span class="header-section-number">32.6.1</span> The SIR Model</h3>
<p>We’ll be developing several SIR models to better understand the spread of simple contagions. SIR is a <strong>compartmental model</strong> of disease spread that partitions a population into three compartments:</p>
<ul>
<li><strong>susceptible</strong> people, who may become infected in the future,</li>
<li><strong>infected</strong> people are people who may spread the disease, and</li>
<li><strong>recovered/removed</strong> people, who, depending on the model have either died or recovered and developed immunity.</li>
</ul>
<p>Traditional SIR models describe transitions between these compartments using a set of differential equations. Note that the equation for each population takes into account other population compartments. As one changes, the others will change. The Susceptible population will become infected at a rate proportional to <strong>the number of Infected and Susceptible</strong> (the more there are of one or the other, the faster a disease will spread), but slowed down by the total population size, a kind of proxy for population density. The Infected population will increase at the same rate that the Susceptible population decreases, as people move from one compartment to the other, but it will also decrease at a rate relative to its size and how quickly people recover from the disease. Similarly, the Recovered compartment will increase at the same rate that the Infected compartment is losing population. We’ll see this in happen in the simulations that follow:</p>
<p><span class="math display">\[\begin{align}
\frac{dS}{dt} &amp;= - \left( \frac{a}{N}\right)  I S \\
\frac{dI}{dt} &amp;= \left( \frac{a}{N}\right)  I S - b I \\
\frac{dR}{dt} &amp;= bI
\end{align}\]</span></p>
<p>Subject to <span class="math inline">\(R_0 = \frac{a}{b}\)</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\(\frac{dS}{dt}\)</span>, <span class="math inline">\(\frac{dI}{dt}\)</span>, and <span class="math inline">\(\frac{dR}{dt}\)</span> represents the <em>rate of change</em> in the relevant population compartment</li>
<li><span class="math inline">\(N\)</span> is the total population</li>
<li><span class="math inline">\(R_0\)</span> represents the ability of a single infected individual to infect others, the <strong>basic reproduction rate</strong></li>
<li><span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> are parameters that can be related to the typical time between contacts and the typical time until an Infected becomes Recovered.</li>
</ul>
<p>While powerful in its simplicity, the differential equation SIR model pays for that simplicity by assuming that there is homogenous mixing between populations. Human agency and behaviour is abstracted away until people act like atoms bouncing into each other. This is where network SIR models have made their contribution.</p>
<section id="initializing-and-configuring-the-sir-model" class="level4" data-number="32.6.1.1">
<h4 data-number="32.6.1.1" class="anchored" data-anchor-id="initializing-and-configuring-the-sir-model"><span class="header-section-number">32.6.1.1</span> Initializing and Configuring the SIR Model</h4>
<p>As we are interested in epidemic spread of contagions through networks, we won’t be using differential equations. We will be using NDLib to produce our <em>simulations</em>. There is a few differences in how NDLib handles SIR models compared to the above differential equations, that arise out of the fact that NDLib works on networks rather than equations. The above equations are continuous, while NDLib uses strict integer counts of nodes for each status/compartment and time steps. The differential equation SIR model is deterministic, but NDLib uses probabilistic infection and recovery. For the sake of clarity, NDLib uses status instead of compartment, and removed instead of recovered. These last two differences are purely semantic and you can use whichever is most appropriate for your particular model.</p>
<p>The parameters governing how the simulation will unfold are stored in a special model configuration object. As just described, the SIR model takes two parameters. For the sake of clarity, I have used <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> in the differential equation model and the more traditional <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\gamma\)</span> for the probabilistic NDLib parameters:</p>
<ul>
<li><code>beta</code> (<span class="math inline">\(\beta\)</span>) is the probability of infection, and</li>
<li><code>gamma</code> (<span class="math inline">\(\gamma\)</span>) is the probability of recovery.</li>
</ul>
<p>In addition to these two parameters, we have to specify the percentage of nodes that are activated / infected at the start the start of our simulation – the dawn of time for our simulated society. We’ll start by setting the probability of infection at 5% and the probability of recovery at 1%, and by randomly infecting 10% of the network.</p>
<p>Since we’ll be executing multiple simulations, we’ll define a custom function that let’s us simplify the process of configuring new SIR models.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> sir_model(network, beta, gamma, fraction_infected):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> ep.SIRModel(network)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    config <span class="op">=</span> mc.Configuration()</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    config.add_model_parameter(<span class="st">'beta'</span>, beta)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    config.add_model_parameter(<span class="st">'gamma'</span>, gamma)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    config.add_model_parameter(<span class="st">"fraction_infected"</span>, fraction_infected)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    model.set_initial_status(config)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>sir_model_1 <span class="op">=</span> sir_model(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    G, beta<span class="op">=</span><span class="fl">0.05</span>, gamma<span class="op">=</span><span class="fl">0.01</span>, fraction_infected<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>sir_model_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="executing-the-simulations" class="level4" data-number="32.6.1.2">
<h4 data-number="32.6.1.2" class="anchored" data-anchor-id="executing-the-simulations"><span class="header-section-number">32.6.1.2</span> Executing the Simulations</h4>
<p>NDLib offers two different methods for executing the simulations. The <code>.iteration()</code> method executes a single iteration (1 step through time) and <code>.iteration_bunch()</code> executes <span class="math inline">\(n\)</span> iterations. Below, we’ll execute 200 iterations, which means we will step through 200 moments in time, executing the probabilistic model’s rules, and assessing node states at each step. We’ll set the argument <code>node_status</code> to <code>True</code> so that the method returns information about the status of each node in each iteration, rather than just summary statistics for the overall population. We will use ` to suppress the overly verbose output that tells us about the progress of each iteration.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sir_1_iterations <span class="op">=</span> sir_model_1.iteration_bunch(<span class="dv">200</span>, node_status<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>.iteration_bunch()</code> returns a list containing data on each of the 200 iterations in our simulation. The data pertaining to each individual iteration is provided in the form of a dictionary with the following key-value pairings:</p>
<ul>
<li><strong>iteration</strong>, which tells us which iteration of the simulation the data pertain to.</li>
<li><strong>status</strong> is another dictionary. Each key in this dictionary is a node ID and the corresponding value indicates their status at that particular iteration. The length of this dictionary is therefore equal to the number of nodes in the population.</li>
<li><strong>node_count</strong> is another dictionary where the keys represent node states and the values indicate the cumulative sum of nodes with that state, up to and including the present iteration.</li>
<li><strong>status_delta</strong> is yet another dictionary, this time providing information about how the number of nodes in each of the status categories has changed since the previous iteration. For example, a delta of 2 for the ‘Infected’ status would indicate that 2 additional people were infected in this iteration. A value of -3 for the ‘Susceptible’ status would indicate that three nodes switched from susceptible in the previous iteration to a different state in the present iteration.</li>
</ul>
<p>In other words, most of the data returned by <code>.iteration_bunch()</code> is in the form of dictionaries nested inside other dictionaries, organized as a list. The innermost dictionaries are what tell us what has happened in any particular point in time during the simulation process. For example, to get data that can be used to plot the trend line for each status, we could iterate over the list and extract the <code>'node_count'</code> data for each iteration. Below we preview the first 10.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>[iteration[<span class="st">'node_count'</span>] <span class="cf">for</span> iteration <span class="kw">in</span> sir_1_iterations][:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Iterating over the models results is straightforward, but since we’re going to be performing a fair number of simulations and we’ll be looking for the same nested information each time, we’ll define a few custom functions that allow us to easily extract the information we want.</p>
<p>The <code>simulation_overview()</code> function, defined below, iterates over the results of the simulations and extracts:</p>
<ol type="1">
<li>the number of nodes in each state at each iteration, converted to a proportion of the overall population; and</li>
<li>the status deltas for each iteration, which tell us how the numbers of nodes in each status category change between simulation runs, such as +3 infected, -3 susceptible.</li>
</ol>
<p>Both are returned as dataframes.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simulation_overview(iteration_results, network, prop<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    population_size <span class="op">=</span> network.number_of_nodes()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    trends <span class="op">=</span> []</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    deltas <span class="op">=</span> []</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> iteration <span class="kw">in</span> iteration_results:</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>        trends.append(iteration[<span class="st">'node_count'</span>])</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>        deltas.append(iteration[<span class="st">'status_delta'</span>])</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>    columns <span class="op">=</span> [<span class="st">'Susceptible'</span>, <span class="st">'Infected'</span>, <span class="st">'Removed'</span>]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trends DF</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    trends <span class="op">=</span> pd.DataFrame(trends)</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    trends.columns <span class="op">=</span> columns</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> prop <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>        trends <span class="op">=</span> trends.div(population_size)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># deltas DF</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>    deltas <span class="op">=</span> pd.DataFrame(deltas)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    deltas.columns <span class="op">=</span> columns</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> trends, deltas</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll use our custom function <code>simulation_overview()</code> to parse the output from the simulation model we just executed and create our two dataframes.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sir_1_trends, sir_1_deltas <span class="op">=</span> simulation_overview(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    sir_1_iterations, G</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>)    </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>sir_1_trends.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>From here, we can plot (1) trends in the number of susceptible, infected, and removed nodes; and (2) the compartment deltas. The results are shown in <a href="#fig-16_03" class="quarto-xref">Figure&nbsp;<span>33.2</span></a>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>sir_1_trends)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    xlabel<span class="op">=</span><span class="st">'Iteration / step in time'</span>, ylabel<span class="op">=</span><span class="st">'Proportion of nodes'</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_03.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_03" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_03.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.2: png
</figcaption>
</figure>
</div>
<p>This plot offers a high-level summary of what has happened to our simulated society over time. In this particular case, we can see the proportion of infected nodes increases dramatically, infecting more than 70% of the population in fewer than 50 iterations (when you factor in those who had already recovered by iteration 50, about 90% of the population had been infected, but some had already recovered). At the same time, the number of susceptible nodes decreases (which we should expect, given the zero-sum and unidirectional nature of the SIR model). Over time, there is a fairly steady increase in the number of nodes who are removed from the simulation due to immunity or death.</p>
<p>Let’s also take a quick look at the deltas for each state (<a href="#fig-16_04" class="quarto-xref">Figure&nbsp;<span>33.3</span></a>).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>fig, (ax1, ax2, ax3) <span class="op">=</span> plt.subplots(<span class="dv">3</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">8</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax <span class="op">=</span> ax1, data<span class="op">=</span>sir_1_deltas[<span class="st">'Susceptible'</span>], color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax <span class="op">=</span> ax2, data<span class="op">=</span>sir_1_deltas[<span class="st">'Infected'</span>], color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>sns.lineplot(ax <span class="op">=</span> ax3, data<span class="op">=</span>sir_1_deltas[<span class="st">'Removed'</span>], color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">## EMPHASIZE DEVIATIONS FROM 0</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>ax1.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'crimson'</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>ax2.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'crimson'</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>ax3.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">'crimson'</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>ax3.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Iteration'</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_04.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_04" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_04.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.3: png
</figcaption>
</figure>
</div>
<p>This plots shows how the number of nodes in each of the three possible node states changes from one iteration to the next, and is not cumulative. It should make some intuitive sense: in the SIR model, a susceptible node can either stay susceptible or become infected, an infected node can either stay infected or become removed, and a removed node cannot change state. Therefore, the susceptible population should always decrease, the infected population can increase or decrease, and the recovered population always increases.</p>
</section>
<section id="wait-who-did-we-just-infect" class="level4" data-number="32.6.1.3">
<h4 data-number="32.6.1.3" class="anchored" data-anchor-id="wait-who-did-we-just-infect"><span class="header-section-number">32.6.1.3</span> Wait, Who Did We Just Infect?</h4>
<p>Recall that NDLib is simulating discrete nodes in a network, rather than solving differential equations. <a href="#fig-16_05" class="quarto-xref">Figure&nbsp;<span>33.4</span></a> provides a bit of additional insight into what has happened to our simulated society throughout this process. We took 200 steps through time, but a lot of action happened in just the first 20 steps. Each of the subplots in the Figure below represents one of the first 20 iterations. At each iteration, the nodes are crimson if they are newly infected, or were infected in a previous iteration. Grey nodes are susceptible. Some of these nodes of course transitioned to the “removed” state, but for pedagogical reasons, my interest here is in highlighting the specific paths the contagion moves along. Though there are, of course, some clusters that form around the initial seed infections, there is no indication that the contagion gets “stuck” in those clusters. It spreads easily to infect surrounding nodes.</p>
<p>There is another (more important) pedagogical reason for this figure: to emphasize that it’s just <em>one</em> of many possible outcomes. We’ve performed a <em>single simulation</em> over 200 time steps. Showing this sequence of snapshots of the network over time is a useful reminder that at any point in this process, including T0 where we see the nodes that were randomly infected at the start of our model, <em>things could have gone differently</em>, unlike with deterministic SIR models using differential equations, which always give the same results. We might have selected a different random subset, for example. Since the transmission process is probabilistic, minor differences in which nodes get infected at any given point in the process could have an impact on what happens later, such as opening up or closing off certain regions of the network to the contagion. All of this and more is possible with the <em>exact</em> same model we used, with the same probabilities of infection and removal.</p>
<p>What should we do? Simulate a <em>whole lot more</em> and look at aggregate patterns across all of those simulations. Let’s do that now.</p>
<p><img src="figures/activations_first_20.png" class="img-fluid"></p>
</section>
<section id="lets-do-that-500-more-times" class="level4" data-number="32.6.1.4">
<h4 data-number="32.6.1.4" class="anchored" data-anchor-id="lets-do-that-500-more-times"><span class="header-section-number">32.6.1.4</span> Let’s Do That 500 More Times</h4>
<p>NDLib’s <code>multi_runs()</code> function enables us to easily execute many simulations from the same model, and because each simulation is independent of the others, they can be executed efficiently in parallel. This time, let’s use <code>multi_runs()</code> to execute 500 simulations, each with 200 iterations.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>trends <span class="op">=</span> multi_runs(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    sir_model_1, </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>, </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">200</span>, </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span><span class="va">None</span>, </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The results returned by <code>multi_runs()</code> are very similar to that returned by <code>iteration_bunch()</code>, only more deeply nested. The custom function from the utilities package, parses the output and produces a trend plot (<a href="#fig-16_06" class="quarto-xref">Figure&nbsp;<span>33.5</span></a>).</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    trends, </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>G, </span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_06.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_06" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_06.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.4: png
</figcaption>
</figure>
</div>
<p>This figure conveys the same type of information as the first trend plot we produced, only this time it does so for 500 simulations with 200 iterations rather than 1 simulation with 200 iterations. Each thin gray line represents the trend for one of the three possible states across the iterations of a single simulation, and the three more prominent lines represent the median trend across all 500. As you can see, there are a few simulations that deviate from the pack, but for the most part the patterns are very clear, and things don’t fluctuate wildly across runs.</p>
<p>Now that we’ve seen the logic of how to develop diffusion models in NDLib, and we’ve seen how to parse the results of the simulations and visualize their results, we’re ready to start using actual empirical network data.</p>
</section>
</section>
<section id="from-simulated-societies-to-denmark" class="level3" data-number="32.6.2">
<h3 data-number="32.6.2" class="anchored" data-anchor-id="from-simulated-societies-to-denmark"><span class="header-section-number">32.6.2</span> From Simulated Societies to Denmark</h3>
<p>For the rest of this chapter, we will make use of network data collected as part of the the Copenhagen Networks Study <span class="citation" data-cites="sapiezynski2019interaction stopczynski2014measuring">(see <a href="references.html#ref-sapiezynski2019interaction" role="doc-biblioref">Sapiezynski et al. 2019</a>; <a href="references.html#ref-stopczynski2014measuring" role="doc-biblioref">Stopczynski et al. 2014</a>)</span>. This dataset is a multilayer temporal network made up of more than 700 university students in Copenhagen. It was collected using smartphones, 3rd party APIs, and online questionnaires. The layers consist of a physical proximity network using Bluetooth signal strength, phone calls, text-messages, and Facebook friendships. Each of these network types has additional information regarding the relations, including time stamps, phone call duration, and so on. I recommend reading <span class="citation" data-cites="sapiezynski2019interaction">Sapiezynski et al. (<a href="references.html#ref-sapiezynski2019interaction" role="doc-biblioref">2019</a>)</span> to learn more about this dataset in general.</p>
<p>The data we’ll use here is a subset of the bluetooth physical co-location network data that I’ve filtered to include interactions that occurred over a roughly 24 hour period.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>cns_url <span class="op">=</span> <span class="st">"https://www.dropbox.com/scl/fo/svfktjetp2j8we2mh2s3g/ADogVe6DhJPEwIEsiGJndjI?rlkey=fozovcld3xdztawxj2hxzvxzv&amp;st=016vi6lr&amp;dl=0"</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>download_dataset(cns_url, <span class="st">'data/copenhagen_networks_study/'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>bluetooth_contact <span class="op">=</span> pd.read_csv(<span class="st">"data/copenhagen_networks_study/cns_bluetooth_filtered.csv"</span>, sep<span class="op">=</span><span class="st">','</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>bluetooth_contact.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As we’ve done in previous chapters, we can use the <code>from_pandas_edgelist()</code> function to create a NetworkX graph object from the <code>bluetooth_contact</code> dataframe. In this case the researchers have used <code>user_a</code> and <code>user_b</code> instead of <code>i</code> and <code>j</code>, but as long as NetworkX knows which two columns represent an edge, it’s perfectly content.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>g_bluetooth_contact <span class="op">=</span> nx.from_pandas_edgelist(bluetooth_contact, <span class="st">'user_a'</span>, <span class="st">'user_b'</span>, create_using<span class="op">=</span>nx.Graph())</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>g_bluetooth_contact.name <span class="op">=</span> <span class="st">'CNS Bluetooth Contact'</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(g_bluetooth_contact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>layout <span class="op">=</span> nx.nx_pydot.graphviz_layout(g_bluetooth_contact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This network is quite dense, so visualizing it is a bit tough. In <a href="#fig-16_07" class="quarto-xref">Figure&nbsp;<span>33.6</span></a>, I overlay a contour plot to give an idea of where the density lies, and what kind of gradient it follows.</p>
<ul>
<li><strong>TODO: Update this; gt here too?</strong></li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>for_contour <span class="op">=</span> pd.DataFrame([v <span class="cf">for</span> k,v <span class="kw">in</span> layout.items()])</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">12</span>))</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x<span class="op">=</span>for_contour[<span class="dv">0</span>],y<span class="op">=</span>for_contour[<span class="dv">1</span>])</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>nx.draw(g_bluetooth_contact,</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        pos<span class="op">=</span>layout,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>        node_color<span class="op">=</span><span class="st">'gray'</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>        edge_color<span class="op">=</span><span class="st">'gray'</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        node_size<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="fl">.5</span>,</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>       alpha<span class="op">=</span><span class="fl">.3</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_07.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_07" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_07.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.5: png
</figcaption>
</figure>
</div>
<p>Let’s also inspect the degree distribution (<a href="#fig-16_08" class="quarto-xref">Figure&nbsp;<span>32.6</span></a>).</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>deg <span class="op">=</span> pd.Series(</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">dict</span>(g_bluetooth_contact.degree())</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>sns.ecdfplot(deg)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>ax.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Node degree'</span>)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_08.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_08" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_08-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_08.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_08-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.6: png
</figcaption>
</figure>
</div>
<p>Now we’re ready to develop our second SIR model. We’ll keep the same <code>beta</code> (<span class="math inline">\(\beta\)</span>) and <code>gamma</code> (<span class="math inline">\(\gamma\)</span>) parameters, and the same proportion of initially infected nodes. Unlike last time, we’ll let our simulations run for 300 iterations, and we’ll execute a batch of 500. In order to compare our results against future models, we’re going to set the initially infected nodes so we can isolate the effects of changing parameters. While we are choosing the nodes randomly, we’ll set a seed for the random number generator to keep results consistent for the book. You would not normally do this for research purposes. Since we’re running 500 simulations, we will produce 500 initial infection sets.</p>
<p>The results are shown in <a href="#fig-16_09" class="quarto-xref">Figure&nbsp;<span>32.7</span></a>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> copy</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">42</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> rand_infection_set(network, frac):</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Randomly select nodes from node_list without replacement</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>    node_list <span class="op">=</span> <span class="bu">list</span>(network.nodes())</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>    sample <span class="op">=</span> random.sample(</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>        node_list, </span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">int</span>(<span class="bu">round</span>(<span class="bu">len</span>(node_list)<span class="op">*</span>frac, <span class="dv">0</span>))</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sample</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>infect_sets <span class="op">=</span> [</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    rand_infection_set(</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>        g_bluetooth_contact, <span class="fl">0.1</span>) </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">500</span>)</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sir_model_2 <span class="op">=</span> sir_model(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    g_bluetooth_contact,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    beta<span class="op">=</span><span class="fl">0.05</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    fraction_infected<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>sir_model_2_trends <span class="op">=</span> multi_runs(</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    sir_model_2,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    sir_model_2_trends, network<span class="op">=</span>g_bluetooth_contact, proportion<span class="op">=</span><span class="va">True</span>, return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_09.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_09" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_09-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_09.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_09-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.7: png
</figcaption>
</figure>
</div>
<p>We see the same general pattern we saw before, with an early spike of infections that spreads rapidly through the population, accompanied by a decline in the proportion of susceptible nodes. And as before, we see a fairly steady increase over time in the number of nodes that are removed by immunity or death. By the 100th iteration, nearly every susceptible individual has been infected, and all that remains is the recovery process. Note, however, that if we had more isolated components in the network, rather than one large one, some simulations might have hade very different results. Since contagions cannot spread without an interaction, each component would need to have at least one infected node at T0 for infection to be a possibility. In general, the higher the number of components in a network, the more important the number and distribution of initial infections will be.</p>
<p>Another thing to note from these visualizations is that the trends across all simulations are usually more tightly clustered together right at the dawn of simulated time than they are as the simulation progress. Since each simulation starts with the same conditions, they have little room to diverge from each other. As the infection spreads with some random chance at each time point, different parts of the network may open up at different rates, and different initially infected nodes may be more conducive to faster or slower transmissions through the network.</p>
<p>Now let’s model a simple contagion with <span class="math inline">\(\beta = 0.01\)</span>, dramatically dropping the probability of transmitting an infection. The results are shown in <a href="#fig-16_10" class="quarto-xref">Figure&nbsp;<span>32.8</span></a>.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sir_model_3 <span class="op">=</span> sir_model(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    g_bluetooth_contact,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    beta<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    gamma<span class="op">=</span><span class="fl">0.01</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    fraction_infected<span class="op">=</span><span class="fl">0.1</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>sir_model_3_trends <span class="op">=</span> multi_runs(</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    sir_model_3,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    sir_model_3_trends, network<span class="op">=</span>g_bluetooth_contact, proportion<span class="op">=</span><span class="va">True</span>, return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_10.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_10" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_10.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;32.8: png
</figcaption>
</figure>
</div>
<p>Notice that lowering the probability that an infected person transmits the contagion to a neighbour has produced several noticable differences. First, the initial spike of infections is much less sharp, and its effects are more spread out over time. Public health interventions during a pandemic will often focus on reducing the disease’s <span class="math inline">\(\beta\)</span> because it helps “flatten the curve.” A region’s healthcare facilities usually operate close to their maximum capacity during non-pandemic times for the sake of efficiency, but that means that sudden spikes can overwhelm the available resources. Reducing the rate of infection, by mandating wearing masks for example, can help buffer the system against rapid shocks.</p>
<p>You may also notice that Susceptible populations in the simulations tend to settle at a higher point than in the previous model, roughly in 5-10% range. This is because individuals are spreading the contagion less before recovering, resulting in the recovered/removed individuals forming a barrier around small portions of the network and preventing further spread into those areas.</p>
</section>
<section id="simple-contagions-on-dynamic-networks" class="level3" data-number="32.6.3">
<h3 data-number="32.6.3" class="anchored" data-anchor-id="simple-contagions-on-dynamic-networks"><span class="header-section-number">32.6.3</span> Simple Contagions on Dynamic Networks</h3>
<p>So far, we have only examined static networks; the network’s structure does not change over the course of the contagion’s spread. A discussion of dynamic networks is unfortunately beyond the scope of this book, but if you are interested, the process is a generalization of what we have just done, however we pass NDLib a series of snapshots of the network at different time points. A brief example is provided in the online supplementary learning materials.</p>
</section>
</section>
<section id="conclusion-1" class="level2" data-number="32.7">
<h2 data-number="32.7" class="anchored" data-anchor-id="conclusion-1"><span class="header-section-number">32.7</span> CONCLUSION</h2>
<section id="key-points" class="level3" data-number="32.7.1">
<h3 data-number="32.7.1" class="anchored" data-anchor-id="key-points"><span class="header-section-number">32.7.1</span> Key Points</h3>
<ul>
<li>Learned key social contagion terminology</li>
<li>Discussed the differential equation SIR model and contrasted it against the network simple contagion model</li>
<li>Used NDLib to run network contagion simulations</li>
<li>Laid the groundwork for discussing complex contagions</li>
</ul>
</section>
</section>
</section>
<section id="not-so-fast-modelling-the-diffusion-of-complex-contagions" class="level1" data-number="33">
<h1 data-number="33"><span class="header-section-number">33</span> Not so Fast: Modelling the Diffusion of Complex Contagions</h1>
<section id="learning-objectives-2" class="level2" data-number="33.1">
<h2 data-number="33.1" class="anchored" data-anchor-id="learning-objectives-2"><span class="header-section-number">33.1</span> LEARNING OBJECTIVES</h2>
<ul>
<li>Differentiate between simple and complex contagions</li>
<li>Compare the typical diffusion processes for simple and complex contagions</li>
<li>Explain the role that contagion, network structure, and individual thresholds play in threshold models of diffusion and social influence</li>
<li>Develop simulations and computational experiments of complex diffusion processes with NDLib</li>
</ul>
</section>
<section id="learning-materials-1" class="level2" data-number="33.2">
<h2 data-number="33.2" class="anchored" data-anchor-id="learning-materials-1"><span class="header-section-number">33.2</span> LEARNING MATERIALS</h2>
<p>You can find the online learning materials for this chapter in <code>doing_computational_social_science/Chapter_18</code>. <code>cd</code> into the directory and launch your Jupyter Server.</p>
</section>
<section id="introduction-1" class="level2" data-number="33.3">
<h2 data-number="33.3" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">33.3</span> INTRODUCTION</h2>
<p>In the last chapter we discussed the epidemic spread of simple contagions though networks, focusing on simple epidemiological models of disease spread. Many people use analogies to infectious diseases to describe how other types of things spread through networks, such as beliefs and behaviours. To do so is a mistake with potentially negative impacts. To understand why, I’ll introduce the idea of complex contagions and compare them to simple contagions. We’ll also break down some of the most important differences in the mechanisms and network structures that govern their spread. Then I’ll introduce threshold models for complex contagions, and show you how to configure, execute, and interpret them using NDLib.</p>
</section>
<section id="from-simple-to-complex-contagions" class="level2" data-number="33.4">
<h2 data-number="33.4" class="anchored" data-anchor-id="from-simple-to-complex-contagions"><span class="header-section-number">33.4</span> FROM SIMPLE TO COMPLEX CONTAGIONS</h2>
<p><strong>Complexity</strong> is an important concept that takes the idea of multiple exposures a step further than mere counts. Just like the network perspective on simple contagions, it does so by taking the relationship between micro-level contexts and macro-level network structures very seriously. The difference is in the details.</p>
<p>Whereas simple contagions can spread easily with exposure from even a single contact with a single alter, <strong>complex contagions</strong> require multiple exposures from multiple <em>sources</em> to spread. The ultimate difference comes down to whether one <em>chooses</em> to become activated, or to “<strong>adopt</strong>” the contagion. For example, you don’t “choose” to catch a cold from your cousin’s kid; exposure is sufficient. But you can choose whether to sign up for the latest social media platform, to wear the same style of clothes in 2021 that my parents wore in 1991 (which, inexplicably, is a thing), or to join a violent far-right mob and storm the US capitol building. In all of these case <em>and many others</em>, there is some sort of cost or risk involved in activation, which may range from small (“My Millennial friends will tease me for dressing like their parents did in 1991”) to large (“Things might end poorly for me if I join a violent far-right mob and storm the US capitol building”).</p>
<p>In his groundbreaking work on complex contagion, Damon <span class="citation" data-cites="centola2018behavior">Centola (<a href="references.html#ref-centola2018behavior" role="doc-biblioref">2018</a>)</span> pointed out that <strong>social confirmation</strong>, or <strong>social proof</strong>, is much more important when there is a lot at stake, or when there is a lot of risk and uncertainty involved. More specifically, he proposes four social mechanisms that shape the spread of complex contagions in ways that differ profoundly from simple contagions.</p>
<ol type="1">
<li><strong>Strategic complementarity</strong> comes into play when a contagion becomes more useful as the number of other adopters increases. Using an open source end-to-end encrypted messaging app like Signal is a <em>great</em> idea, but it’s not very useful if you’re the only one using it. It becomes much more valuable if the people you want to communicate with are also using it.</li>
<li><strong>Credibility</strong> comes into play when a contagion is unknown, untested, or considered risky, and therefore nodes are unlikely to activate until they have seen several neighbours do so without negative consequences, or prove the value of activating (again, “social proof”).</li>
<li><strong>Legitimacy</strong> comes into play when the perception of <strong>social</strong> risk or value of a behaviour depends on the number of activated neighbours. If a dramatic new fashion trend puts you at the edge of your comfort zone, seeing multiple neighbours wearing that style may make you more comfortable adopting it.</li>
<li><strong>Emotional contagion</strong> comes into play when the excitement of adopting the contagion in influenced by, or influences, the excitement of neighbours.</li>
</ol>
<p>Credibility and legitimacy may seem closely related, or even the same, as they both relate to perceptions of risk. The distinction arises out of where the risk is perceived. Credibility relates to the risk of the contagion: “this technique is new and potentially dangerous to my patients.” Legitimacy relates to the <em>social</em> risks of being activated. The risk (or the perception of risk) comes from one’s neighbors. Ensuring a contagion is credible may require only a few positive examples. Ensuring a contagion is legitimate may require a certain portion of one’s neighbours be activated. This will come up in our discussion of <strong>thresholds</strong> later. A complex contagion may be driven by any combination of the above mechanisms.</p>
<p>Consider, then, what complex contagions need to spread. The basic idea is illustrated in <span class="quarto-unresolved-ref">?fig-17_01</span>. In this scenario, let’s say Eric is considering signing up for a new fitness app that he heard about on a podcast. The app is free to use as long as you complete the workouts you say you’re going to complete, but if you skip a workout without a good reason the app charges your card and donates £10 to a cause you find morally and politically objectionable. Ouch. What a gut punch that would be.</p>
<p>Eric’s friend Chitra is already using the app. She loves the idea and enthusiastically promotes it to everyone she knows, including Eric. (The size of the arrow reflects her energetic promotion of the app.) But most of Eric’s good friends don’t use the app and Chitra’s enthusiasm alone is just not enough to tip Eric into adopting. Then Eric learns that Yevgen has also been using the app and, having recently lost £10 to the campaign of a politician with a penchant for recklessly spreading bullshit, has never been so fired up about glute bridges and deadlifts. Now he never skips leg day. Still, Eric doesn’t budge. The idea of losing £10 to a politician with a penchant for spreading bullshit is just too high a risk. But then Jamuna adopts the app. Maybe it’s not so bad?</p>
<p>Eric adopts.</p>
<p><img src="figures/contagion_complex.png" class="img-fluid"></p>
<p>In these cases, we’ve focused on differences in what simple and complex contagions need to spread through a network. The main difference boils down to whether exposure from a single source is sufficient to activate a node (“Karen told me she’s storming the US capitol building on Wednesday. I am most definitely not doing that.”) or whether more social confirmation is required to make a decision to activate (“<em>Everyone I know is storming the capitol building on Wednesday</em>… I guess that’s a thing that happens now? And Karen graciously offered to give me a ride to the riot, so maybe I should go?”).</p>
<p>I realize that in the example above, I’m making light of an extremely serious situation. While possibly in poor taste, I’m using an extreme case to drive home an important point: there are some things that most of us are highly unlikely to do just because we know someone who is doing it, and this is most certainly the case for decisions that involve a non-trivial amount of risk and uncertainty. But it also raises another interesting dimension of the problem: our own individual <strong>thresholds</strong> for social confirmation might vary. Some people might be willing to storm the capitol building when their favoured candidate loses an election because 1/2 of their closest friends are storming the capital. For others it might take 3/4 or 7/8 of their friends. Or perhaps all they need is to know a total of 10 people. Or perhaps they would <em>never</em> storm the capitol building no matter who else was.</p>
<p>How can we take these variations into account? And how does the nature of the contagion, variability in individual thresholds, the social and interaction rules governing the formation of ties in a network, and the emergent structure of the network interact? How do we deal with the probabilistic nature of all of this? <em>How do we manage all this complexity?</em></p>
<p>We’ll be in a position to dig into these questions with some models very soon. But first, let’s take a closer look at some of the ways in which network structure matters in a more <em>global</em> sense, and how it relates to the notion of variability in individual-level thresholds.</p>
<blockquote class="blockquote">
<p><strong>Further Reading</strong></p>
<p>Damon Centola’s <span class="citation" data-cites="centola2018behavior">(<a href="references.html#ref-centola2018behavior" role="doc-biblioref">2018</a>)</span> <em>How Behavior Spreads</em> is the best place to learn about complex contagion theory. <span class="citation" data-cites="centola2007complex">Centola and Macy (<a href="references.html#ref-centola2007complex" role="doc-biblioref">2007</a>)</span> is one of the classic articles on complex contagion theory, and <span class="citation" data-cites="guilbeault2018complex">Guilbeault, Becker, and Centola (<a href="references.html#ref-guilbeault2018complex" role="doc-biblioref">2018</a>)</span> is a more recent review.</p>
</blockquote>
</section>
<section id="beyond-local-neighborhoods-network-effects-and-thresholds" class="level2" data-number="33.5">
<h2 data-number="33.5" class="anchored" data-anchor-id="beyond-local-neighborhoods-network-effects-and-thresholds"><span class="header-section-number">33.5</span> BEYOND LOCAL NEIGHBORHOODS: NETWORK EFFECTS AND THRESHOLDS</h2>
<p>We know that micro-level social mechanisms shape specific exposure events in somewhat predictable ways and govern the transmission of a contagion from one individual to another. We discussed several examples in the previous chapter. These micro-level processes give rise to specific macro-level structures that act in a top-down fashion to constrain our actions and determine the shape and scale of spread through a population. Importantly, these processes differ for simple and complex contagions. If we incorrectly assume that every contagion spreads like a simple contagion, then our efforts to promote specific beliefs (e.g., this vaccine is safe, the election was not rigged) and behaviours (e.g., wearing a mask reduces the likelihood of spreading COVID-19, using condoms helps reduce the spread of STIs) are in vain. <span class="citation" data-cites="centola2018behavior">Centola (<a href="references.html#ref-centola2018behavior" role="doc-biblioref">2018</a>)</span>, for example, has shown through ingenious experimental design and carefully designed simulations that the same network structures that accelerate the spread of a disease (“simple” contagion) can inhibit the spread of behaviours (“complex” contagion) needed to combat those same diseases. These differences are therefore vital to understand if we want to successfully conduct interventions, broadly conceived, and are highly relevant to efforts to promote social and political change <span class="citation" data-cites="centola2021change">(<a href="references.html#ref-centola2021change" role="doc-biblioref">Centola 2021</a>)</span>.</p>
<p>In this section, we’ll discuss some meso- and macro-level network properties that have a strong influence on diffusion. Our starting point is that some network structures are more conducive to spreading processes than others. The most obvious and straightforward example of this is that it’s hard for a contagion to spread through a network composed of many isolated components (which is why lockdowns during COVID-19 have been an effective public health intervention despite causing other problems, such as worsening mental health). Following this discussion, we’ll see how it all plays out when we conduct hundreds or thousands of simulations conditioned on empirical network data.</p>
<section id="complex-contagions-narrow-bridges-wide-bridges-and-thresholds" class="level3" data-number="33.5.1">
<h3 data-number="33.5.1" class="anchored" data-anchor-id="complex-contagions-narrow-bridges-wide-bridges-and-thresholds"><span class="header-section-number">33.5.1</span> Complex Contagions, Narrow Bridges, Wide Bridges and Thresholds</h3>
<p>Understanding complex contagions tends to be, appropriately, more complex than understanding simple contagions. The requirement that a node be exposed to a contagion through multiple sources immediately suggests a diminished role for weak ties and high-betweenness peers. The same things that make those “weak ties” ideally-suited for spreading simple contagions makes them poor conduits of complex contagions. They are, almost by definition, <strong>narrow bridges</strong> between clusters of densely connected nodes. The more they fit that idealized profile of a weak tie, the less likely they are to contribute to the kind of collective pressure that propels the spread of complex contagions.</p>
<p>Centola’s work has shown us that complex contagions require <strong>wide bridges</strong> that involve multiple different sources repeatedly exposing us to the contagion. The question is <em>how wide do those bridges need to be?</em> Or, to put it another way, how many different sources of exposure would it take to flip our state from exposed to activated?</p>
<p>This question of “how many people does it take” is a question of individual <strong>thresholds</strong>, and once again some of the key insights into how to model the role of individual thresholds in diffusion processes are inspired by the work of Mark <span class="citation" data-cites="granovetter1978threshold">Granovetter (<a href="references.html#ref-granovetter1978threshold" role="doc-biblioref">1978</a>)</span>. There are two main things to consider.</p>
<ol type="1">
<li>Should we use a threshold that is uniform for all nodes in the network, or one that varies for each node?</li>
<li>Regardless of whether they are uniform or variable, should thresholds be count-based (e.g., activate if at least 3 alters are activated) or fractional (e.g., activate if 1/3 of alters are activated).</li>
</ol>
<p>The first consideration is largely about whether you want a model that is as simple as possible or one that is more realistic. The second is a bit more difficult because it has significant consequences for how easily different types of nodes in a network can be activated. If the network has a uniform degree distribution (every node has the same degree), a fractional threshold would be effectively identical to a count threshold. If every node has a degree of 3 and a threshold of 2/3, it’s the same as saying they have a count threshold of 2. If, however, there is an uneven degree distribution (as there almost always is) the fractional threshold of 2/3 for a node with degree 3 would be very different from a node with degree 300: 2 versus 200!</p>
<p>How should we decide whether a threshold should be a count or fractional? Theory and domain knowledge! <em>Think about the mechanisms of complexity mentioned earlier, and ask yourself which are likely at play</em>. Where diffusion is a matter of <strong>credibility</strong>, for example, we might expect a count threshold. If a scientist is deciding whether to incorporate a new technique into her work, she might only need a few concrete examples of it working to consider adopting it. The efficacy of the technique does not especially rely on how much of her network has adopted the technique. Where diffusion is a matter of <strong>legitimacy</strong>, on the other hand, we might expect a fractional threshold. If your friend tells you that the 70s are back in fashion, you might wait until some proportion of your personal network has adopted the look before you yourself seriously consider adopting it. If at least half of your friends are bringing back the 70s, you might be a lot more comfortable joining in, or even feel pressured into joining in. That kind of peer pressure/acceptance is very different depending on the size of your personal network, of course.</p>
<p>There could, of course, also be counterveiling forces at play here. You may recall that in a previous chapter I mentioned the notion of <strong>negative ties</strong> (dislike, distrust, disesteem, etc.) that can be observed on their own, or alongside positive ties in a <strong>signed graph</strong>. It is, of course, possible that adoption decisions are also driven by observing what our <em>negative</em> ties do. For example, earlier when we were discussing credibility, I offered the example of a scientist who is considering adopting some sort of new technique. Seeing her peers adopt the technique only signals credibility <em>if she trusts the judgement of her peers</em>. Normally networks researchers collect data on positive ties, which might include asking questions about who you admire or respect. If we were to collect data on negative ties, we might very well find that increases in adoption among those we are negatively tied to decreases the likelihood of our own adoption. However, we should expect that there is individual variability here too, and hopefully few people are embedded in such a mess of negative ties that the weight of those negative ties overwhelms that of the positive. But they might. Despite being rarer than positive ties, we know that negative are disproportionately influential.</p>
<p>There are many benefits to <em>really</em> thinking this through carefully for any given research problem, but as with anything pertaining to complex systems, our intuitions will inevitably fail us at some point and we will be quickly humbled by what we learn from even simple models. Let’s turn to them now.</p>
</section>
</section>
<section id="threshold-models-for-complex-contagions" class="level2" data-number="33.6">
<h2 data-number="33.6" class="anchored" data-anchor-id="threshold-models-for-complex-contagions"><span class="header-section-number">33.6</span> THRESHOLD MODELS FOR COMPLEX CONTAGIONS</h2>
<p>Let’s start by importing the same bluetooth contact data from the last chapter. This will help us see the differences between modelling simple and complex contagions without having to worry about differences in the networks.</p>
<section id="imports-1" class="level3" data-number="33.6.1">
<h3 data-number="33.6.1" class="anchored" data-anchor-id="imports-1"><span class="header-section-number">33.6.1</span> Imports</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> networkx <span class="im">as</span> nx</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ndlib.models.ModelConfig <span class="im">as</span> mc</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ndlib.models.epidemics <span class="im">as</span> ep</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> ndlib.utils <span class="im">import</span> multi_runs</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dcss <span class="im">import</span> set_style</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>set_style()</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dcss.networks <span class="im">import</span> <span class="op">*</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that we downloaded the Copenhagen Networks Study (CNS) data in Chapter 16.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>bluetooth_contact <span class="op">=</span> pd.read_csv(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/copenhagen_networks_study/cns_bluetooth_filtered.csv"</span>, </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    sep<span class="op">=</span><span class="st">','</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>g_bluetooth_contact <span class="op">=</span> nx.from_pandas_edgelist(</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    bluetooth_contact, <span class="st">'user_a'</span>, <span class="st">'user_b'</span>, create_using<span class="op">=</span>nx.Graph()</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>g_bluetooth_contact.name <span class="op">=</span> <span class="st">'CNS Bluetooth Contact'</span></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(g_bluetooth_contact)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now let’s create some <em>threshold models</em> for complex contagions. I’ll start with a simple example, using a fractional threshold of 0.1, and infecting 0.1, or 10%, of the population at T0. I will then contrast this against a model with a fractional threshold of 0.35 and the same initially infected nodes. Then I will compare this second model with a third that has a fractional threshold of 0.35 and an initial infection of 0.15, or 15%, of the population.</p>
<p>Note that we have changed only one variable between model 1 and model 2, increasing the fractional threshold from 0.1 to 0.35 while keeping the same initially infected nodes. With model 3, we are increasing the number of initially infected nodes. To keep the comparison as close as possible between the model 2 and model 3, we will define new sets of intially infected nodes that contain the same nodes as before, and simply adds new ones until the appropriate fraction has been reached.</p>
<p>The results are shown in Figures <span class="quarto-unresolved-ref">?fig-17_02</span>, <span class="quarto-unresolved-ref">?fig-17_03</span>, and <span class="quarto-unresolved-ref">?fig-17_04</span>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>infect_sets <span class="op">=</span> [</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    rand_infection_set(g_bluetooth_contact, <span class="fl">0.1</span>) </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> x <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">500</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>infect_sets_2 <span class="op">=</span> add_to_infection_set(</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    infect_sets, <span class="fl">0.05</span>, g_bluetooth_contact</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>thresh_model <span class="op">=</span> ep.ThresholdModel(g_bluetooth_contact)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>thresh_config <span class="op">=</span> mc.Configuration()</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>fraction_infected <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>thresh_config.add_model_parameter(<span class="st">"fraction_infected"</span>, fraction_infected)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> g_bluetooth_contact.nodes():</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    thresh_config.add_node_configuration(<span class="st">"threshold"</span>, n, threshold)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>thresh_model.set_initial_status(thresh_config)</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>threshold_trends <span class="op">=</span> multi_runs(</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    thresh_model,</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>, </span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets,</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    threshold_trends,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>g_bluetooth_contact,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    states<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Not Activated'</span>, <span class="st">'Activated'</span>],</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_02.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_02" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_02.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_02-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.1: png
</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>thresh_model_2 <span class="op">=</span> ep.ThresholdModel(g_bluetooth_contact)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>thresh_config_2 <span class="op">=</span> mc.Configuration()</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>threshold_2 <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>fraction_infected_2 <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>thresh_config_2.add_model_parameter(<span class="st">"fraction_infected"</span>, fraction_infected_2)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> g_bluetooth_contact.nodes():</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    thresh_config_2.add_node_configuration(</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span>, n, threshold_2</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>thresh_model_2.set_initial_status(thresh_config_2)</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>threshold_trends_2 <span class="op">=</span> multi_runs(</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    thresh_model_2, </span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets, </span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    threshold_trends_2,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>g_bluetooth_contact,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    states<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Not Activated'</span>, <span class="st">'Activated'</span>],</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_03.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_03" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_03.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_03-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.2: png
</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>thresh_model_3 <span class="op">=</span> ep.ThresholdModel(g_bluetooth_contact)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>thresh_config_3 <span class="op">=</span> mc.Configuration()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>threshold_3 <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>fraction_infected_2 <span class="op">=</span> <span class="fl">.15</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>thresh_config_3.add_model_parameter(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fraction_infected"</span>, fraction_infected_2</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> g_bluetooth_contact.nodes():</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    thresh_config_3.add_node_configuration(</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span>, n, threshold_3</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>thresh_model_3.set_initial_status(thresh_config_3)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>threshold_trends_3 <span class="op">=</span> multi_runs(</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>    thresh_model_3,</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets_2,</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    threshold_trends_3,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>g_bluetooth_contact,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>    states<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Not Activated'</span>, <span class="st">'Activated'</span>],</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_04.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_04" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_04.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_04-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.3: png
</figcaption>
</figure>
</div>
<p>Let’s take a look at model 1. Despite starting with only 10% of the population infected, this contagion spreads to the whole population in less than 5 iterations in every simulation. This complex contagion spreads faster than the simple contagions I modelled earlier! After a moment’s reflection, this should make sense. Model 1 has a fractional threshold of 0.1, which means that a node only needs 10% of its neighbours to be activated for the contagion to spread. Given that the average degree is less than 10, that will usually translate to needing a single activated neighbour. While I have <em>technically</em> defined a threshold model for a complex contagion, this contagion will <em>effectively</em> act like a simple contagion with perfect transmissibility for most of the population!</p>
<p>Now let’s compare the results against model 2, where I have set the fractional threshold to 0.35. This is a much stricter threshold. Nodes will now need a little over a third of their neighbours to be activated for a contagion to spread to them. Where model 1 usually required the narrowest of bridges possible, model 2 will require much thicker bridges. As a result, we see that the contagion takes a bit longer to reach its steady state, but perhaps only a few iterations more. The really dramatic difference, though, is how incredibly variable the outcomes are! In most simulations, the contagion doesn’t even infect 20% of the network, while in others, it infects the entire network. In most cases, the initial infections are not situated in the right places to infect the thick bridges key to reaching the network. I will emphasize that this is why we run so many simulations. The positions of the initial infected nodes can <em>dramatically</em> influence the results of a particular simulation, as they may be the difference between a key node, cluster, or bridge activating or not. Based on only these plots, it seems that there may be some key chokepoints or important feature(s) in the network that are difficult for the contagion to infect without the right initial conditions. Recall our earlier visualization of the network in conjunction with the decisions we made about the model, and consider what might be going on. A consequence of the fractional threshold condition is non-adopters apply pressure on their neighbours. Having lots of non-adopter neighbours makes it harder to activate. As a result, hubs are harder to activate than lense dense portions of the network. Keeping in mind the strong core-periphery structure of the network that we visualized, it would be reasonable to hypothesize that, in most cases, the initially infected nodes were too dispersed across the network and unable to activate enough nodes in the core to spread further. Conversely, in the cases where the contagion did manage to spread, the initial infection was likely clustered in key areas, enabling it to build up enough momentum to break into the hub, resulting in rapid infection rates and eventual domination of the network.</p>
<p>In model 3, we increase the proportion of initially infected nodes from 10% to 15% of the population. While this is a relatively small increase, we once again see dramatic differences. The simulations now take over 10 iterations to reach their steady state, and the median proportion of the population infected has risen to <em>almost 100%</em>. In some cases, portions of the network resist infection. The sensitivity to initial conditions and parameter values that these three models and their variablity display is one of the major reasons that complex contagions require very careful consideration and thorough investigation.</p>
<p>Let’s take a moment to compare these results to the simple contagions we modelled in the previous chapter. The earlier SIR models allowed a node to have one of 3 states, Susceptible, Infected, and Recovered/Removed, but these threshold models allow only inactivated and activated states. Once a node has been activated, there is no mechanism to deactivate it (in this model, you cannot forget that juicy gossip or let go of the 70s), so the number of activated nodes can only ever stay the same or increase. This is why we don’t see the peak and drop that occurred in the SIR model. This version of the threshold model is also deterministic once the intially infected nodes have been chosen. Once a node has reached its threshold, it <em>immediately</em> activates. This immediate activation is the main reason we see such a small number of iterations needed to get to the final steady state. The probabilistic SIR model with low probabilitites of infection and recovery can have many steps where nothing changes, or very little changes, even though the <em>potential</em> for change is great. It’s just unlikely, so it takes longer. Of course, just as more advanced SIR models exist, so do more advanced threshold models exist that might have probabilistic activation once a threshold has been met or allow nodes to deactivate based on some condition.</p>
</section>
<section id="complex-contagions-with-variable-thresholds" class="level3" data-number="33.6.2">
<h3 data-number="33.6.2" class="anchored" data-anchor-id="complex-contagions-with-variable-thresholds"><span class="header-section-number">33.6.2</span> Complex Contagions with Variable Thresholds</h3>
<p>So far, what we’ve seen makes some intuitive sense. When the contagion is simple and the thresholds for activation are low, the contagion spreads quickly and activates most of the nodes in the network with little trouble. When the contagion is complex, and the individual thresholds are higher for all the reasons we discussed previously, then the contagion travels much more slowly over wide bridges, and eventually hits a plateau where some cohesive subgroups in the the network are activated and others are not. This sheds some light on how beliefs, behaviours, and norms can be more homogeneous within cohesive subgroups and heterogeneous across them.</p>
<p>All of the earlier threshold models had uniform thresholds: every node had the same threshold for activation. However, as we have mentioned, that is a rather dramatic simplifying assumption. In the real world, not everyone has identical thresholds. Some people have very low thresholds, changing their beliefs and behaviours quickly and easily; others have a high threshold, and are unwilling to change no matter what anyone around them thinks or does. Most, probably, sit somewhere in between. If we expect real people to have some variability in their activation thresholds, perhaps we should account for that in our simulations.</p>
<p>There are a variety of ways we could go about assigning variable thresholds. Here, we will assign each node a threshold by randomly selecting values between 0 (always adopts) and 1 (never adopts) from a probability distribution (which will be introduced in Chapter 26). There are a number of distributions we could choose from here, but as Centola suggests, the best choice is probably simply a Gaussian (i.e.&nbsp;normal) distribution. With variable threshold models, there are even more parameters we can tweak to try to model the spread of a complex contagion. For the sake of brevity, we will compare two models using the same network as before, and the same 10% initially infected nodes. One model will use a Gaussian distribution of threshold scores from 0 to 1 with a mean of .35 and a standard deviation of .001. The other will be the same, but with a standard deviation of 0.1. Intuitively, we might expect the first model to resemble our earlier uniform threshold model with a threshold of 0.35, and the second model might have a higher variance.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> truncnorm</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_truncated_normal(mean, sd, low, upp):</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> truncnorm((low <span class="op">-</span> mean) <span class="op">/</span> sd, (upp <span class="op">-</span> mean) <span class="op">/</span> sd, loc<span class="op">=</span>mean, scale<span class="op">=</span>sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model_cc_vt <span class="op">=</span> ep.ThresholdModel(g_bluetooth_contact)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>config_cc_vt <span class="op">=</span> mc.Configuration()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>fraction_infected <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>random_thresholds <span class="op">=</span> []</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>threshold_dist <span class="op">=</span> get_truncated_normal(</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">=</span><span class="fl">.35</span>, sd<span class="op">=</span><span class="fl">.001</span>, low<span class="op">=</span><span class="dv">0</span>, upp<span class="op">=</span><span class="dv">1</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> g_bluetooth_contact.nodes():</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    threshold <span class="op">=</span> threshold_dist.rvs() </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    config_cc_vt.add_node_configuration(<span class="st">"threshold"</span>, n, threshold)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    random_thresholds.append(threshold)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="co">## WITH THAT DONE, WE CAN ADD </span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co">## THE OTHER MODEL INFORMATION TO THE CONFIG.</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>config_cc_vt.add_model_parameter(</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fraction_infected"</span>, fraction_infected</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>model_cc_vt.set_initial_status(config_cc_vt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>As a quick check, let’s quickly visualize the distribution of randomly sampled individual thresholds using an ecdf, which should be centered on .35 (see <span class="quarto-unresolved-ref">?fig-17_05</span>).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>sns.ecdfplot(random_thresholds)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>sns.despine()</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_05.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_05" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_05.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_05-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.4: png
</figcaption>
</figure>
</div>
<p>And now let’s run the final models, shown in Figures <span class="quarto-unresolved-ref">?fig-17_06</span> and <span class="quarto-unresolved-ref">?fig-17_07</span>.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>threshold_trends_vt <span class="op">=</span> multi_runs(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    model_cc_vt,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    threshold_trends_vt,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>g_bluetooth_contact,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    states<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Not Activated'</span>, <span class="st">'Activated'</span>],</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_06.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_06" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_06.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_06-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.5: png
</figcaption>
</figure>
</div>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>model_cc_vt_2 <span class="op">=</span> ep.ThresholdModel(g_bluetooth_contact)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>config_cc_vt_2 <span class="op">=</span> mc.Configuration()</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>fraction_infected <span class="op">=</span> <span class="fl">.1</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>random_thresholds_2 <span class="op">=</span> []</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>threshold_dist_2 <span class="op">=</span> get_truncated_normal(</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">=</span><span class="fl">.35</span>, sd<span class="op">=</span><span class="fl">.1</span>, low<span class="op">=</span><span class="dv">0</span>, upp<span class="op">=</span><span class="dv">1</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> g_bluetooth_contact.nodes():</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    threshold_2 <span class="op">=</span> threshold_dist_2.rvs() </span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    config_cc_vt_2.add_node_configuration(</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span>, n, threshold_2</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    random_thresholds_2.append(threshold_2)</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>config_cc_vt_2.add_model_parameter(</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"fraction_infected"</span>, fraction_infected</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>model_cc_vt_2.set_initial_status(config_cc_vt_2)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>threshold_trends_vt_2 <span class="op">=</span> multi_runs(</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    model_cc_vt_2,</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    execution_number<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>    iteration_number<span class="op">=</span><span class="dv">40</span>,</span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>    infection_sets<span class="op">=</span>infect_sets,</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    nprocesses<span class="op">=</span><span class="dv">4</span></span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>visualize_trends(</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    threshold_trends_vt_2,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    network<span class="op">=</span>g_bluetooth_contact,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>    states<span class="op">=</span>[<span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>[<span class="st">'Not Activated'</span>, <span class="st">'Activated'</span>],</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    proportion<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    return_data<span class="op">=</span><span class="va">False</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'figures/16_07.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-16_07" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-16_07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/16_07.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-16_07-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;33.6: png
</figcaption>
</figure>
</div>
<p>Wow. These two models appear incredibly distinct! Recall that these models are being run on the same network, with the same initially infected nodes, with the same mean threshold of 0.35. The only difference is the size of the standard standard deviation of their thresholds. For a far deeper and more thorough exploration of variable threshold models, I will once again draw your attention to Centola’s [CITE] work. Let this example serve to emphasize a major theme of this chapter: intuitions can be very unreliable when dealing with complex contagions. Explore every facet of your model and the network because due diligence is especially important when models can be sensitive to initial conditions.</p>
<p>Finally, just as NDLib allows us to extend our models of simple contagions to dynamic networks, so too can we extend complex contagions. I urge you to look into the documentation and experiment with these models!</p>
</section>
<section id="towards-greater-realism-stochastic-thresholds-and-network-diffusion-experiments" class="level3" data-number="33.6.3">
<h3 data-number="33.6.3" class="anchored" data-anchor-id="towards-greater-realism-stochastic-thresholds-and-network-diffusion-experiments"><span class="header-section-number">33.6.3</span> Towards Greater Realism: Stochastic Thresholds and Network Diffusion Experiments</h3>
<p>In these last two chapters, we’ve scratched the surface of modelling the spread of simple and complex contagions and we’ve only focused on two common types of models! To bring this discussion of diffusion to a close, I want to briefly point to two additional things you might consider. First, it is possible to configure some of these models so that thresholds don’t just vary across people in a population, but also <em>within a person over time</em>. This is another step towards greater realism. You know, one day you are feeling pretty open and into new things, another day you aren’t. If we introduce this additional bit of realism, does anything change? To find out, we could use stochastic thresholds instead of deterministic ones, drawing a new threshold for each node at each iteration.</p>
<p>The second consideration is bigger picture. While we have done a lot of modelling in these two chapters to better understand the spread of simple and complex contagions, <em>models are not the real world</em>. However, as the saying goes: all models are wrong, but some models are useful. In order to know which models are useful, we need to validate them against the real world. In the social sciences, natural experiments are usually our bread and butter because controlled experiments are (1) difficult to design, (2) expensive, (3) a lot more work, (4) may contain ethical considerations that cannot be overcome. However, when a controlled experiment is possible, you should take the opportunity! A full discussion of social experimental design is beyond the scope of this book, but I highly recommend reading Centola’s <em>How Behaviour Spreads</em> for an ingenious series of social experiments that he used to validate many ideas and theories we have considered in this chapter.</p>
</section>
</section>
<section id="conclusion-2" class="level2" data-number="33.7">
<h2 data-number="33.7" class="anchored" data-anchor-id="conclusion-2"><span class="header-section-number">33.7</span> CONCLUSION</h2>
<section id="key-points-1" class="level3" data-number="33.7.1">
<h3 data-number="33.7.1" class="anchored" data-anchor-id="key-points-1"><span class="header-section-number">33.7.1</span> Key Points</h3>
<ul>
<li>Learned how complex contagions act differently from simple contagions because they require multiple <em>sources</em> of exposure to spread</li>
<li>Used NDLib to develop simulations for complex contagions</li>
<li>Used the simulations to better understand some of the relations between network structure and complex contagion spread</li>
</ul>
</section>
</section>
</section>
<section id="cultural-cognition-and-opinion-dynamics" class="level1" data-number="34">
<h1 data-number="34"><span class="header-section-number">34</span> Cultural cognition and opinion dynamics</h1>
<ul>
<li>associative diffusion</li>
<li>bounded confidence (bring over from GESIS in previous chapter)</li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bruch2015agent" class="csl-entry" role="listitem">
Bruch, Elizabeth, and Jon Atwell. 2015. <span>“Agent-Based Models in Empirical Social Research.”</span> <em>Sociological Methods &amp; Research</em> 44 (2): 186–221.
</div>
<div id="ref-centola2018behavior" class="csl-entry" role="listitem">
Centola, Damon. 2018. <em>How Behavior Spreads: The Science of Complex Contagions</em>. Princeton University Press Princeton, NJ.
</div>
<div id="ref-centola2021change" class="csl-entry" role="listitem">
———. 2021. <em>Change: How to Make Big Things Happen</em>. Little, Brown Spark.
</div>
<div id="ref-centola2007complex" class="csl-entry" role="listitem">
Centola, Damon, and Michael Macy. 2007. <span>“Complex Contagions and the Weakness of Long Ties.”</span> <em>American Journal of Sociology</em> 113 (3): 702–34.
</div>
<div id="ref-dietz2002daniel" class="csl-entry" role="listitem">
Dietz, Klaus, and JAP Heesterbeek. 2002. <span>“Daniel Bernoulli’s Epidemiological Model Revisited.”</span> <em>Mathematical Biosciences</em> 180 (1-2): 1–21.
</div>
<div id="ref-epstein2006generative" class="csl-entry" role="listitem">
Epstein, Joshua. 2006. <em>Generative Social Science: Studies in Agent-Based Computational Modeling</em>. Princeton University Press.
</div>
<div id="ref-granovetter1973strength" class="csl-entry" role="listitem">
Granovetter, Mark. 1973. <span>“The Strength of Weak Ties.”</span> <em>American Journal of Sociology</em> 78 (6): 1360–80.
</div>
<div id="ref-granovetter1978threshold" class="csl-entry" role="listitem">
———. 1978. <span>“Threshold Models of Collective Behavior.”</span> <em>American Journal of Sociology</em> 83 (6): 1420–43.
</div>
<div id="ref-guilbeault2018complex" class="csl-entry" role="listitem">
Guilbeault, Douglas, Joshua Becker, and Damon Centola. 2018. <span>“Complex Contagions: A Decade in Review.”</span> <em>Complex Spreading Phenomena in Social Systems</em>, 3–25.
</div>
<div id="ref-kermack1927contribution" class="csl-entry" role="listitem">
Kermack, William Ogilvy, and Anderson McKendrick. 1927. <span>“A Contribution to the Mathematical Theory of Epidemics.”</span> <em>Proceedings of the Royal Society of London. Series A, Containing Papers of a Mathematical and Physical Character</em> 115 (772): 700–721.
</div>
<div id="ref-macy2002factors" class="csl-entry" role="listitem">
Macy, Michael W, and Robert Willer. 2002. <span>“From Factors to Actors: Computational Sociology and Agent-Based Modeling.”</span> <em>Annual Review of Sociology</em> 28 (1): 143–66.
</div>
<div id="ref-macy2009social" class="csl-entry" role="listitem">
Macy, Michael, and Andreas Flache. 2009. <span>“Social Dynamics from the Bottom up: Agent-Based Models of Social Interaction.”</span> <em>The Oxford Handbook of Analytical Sociology</em>, 245–68.
</div>
<div id="ref-rossetti2017ndlib" class="csl-entry" role="listitem">
Rossetti, Giulio, Letizia Milli, Salvatore Rinzivillo, Alina Sirbu, Dino Pedreschi, and Fosca Giannotti. 2017. <span>“Ndlib: Studying Network Diffusion Dynamics.”</span> In <em>2017 IEEE International Conference on Data Science and Advanced Analytics (DSAA)</em>, 155–64. IEEE.
</div>
<div id="ref-rossetti2018ndlib" class="csl-entry" role="listitem">
Rossetti, Giulio, Letizia Milli, Salvatore Rinzivillo, Alina Sı̂rbu, Dino Pedreschi, and Fosca Giannotti. 2018. <span>“NDlib: A Python Library to Model and Analyze Diffusion Processes over Complex Networks.”</span> <em>International Journal of Data Science and Analytics</em> 5 (1): 61–79.
</div>
<div id="ref-sapiezynski2019interaction" class="csl-entry" role="listitem">
Sapiezynski, Piotr, Arkadiusz Stopczynski, David Dreyer Lassen, and Sune Lehmann. 2019. <span>“Interaction Data from the Copenhagen Networks Study.”</span> <em>Scientific Data</em> 6 (1): 1–10.
</div>
<div id="ref-shaw2015mechanics" class="csl-entry" role="listitem">
Shaw, Lynette. 2015. <span>“Mechanics and Dynamics of Social Construction: Modeling the Emergence of Culture from Individual Mental Representation.”</span> <em>Poetics</em> 52: 75–90.
</div>
<div id="ref-shaw2019charting" class="csl-entry" role="listitem">
———. 2019. <span>“Charting the Emergence of the Cultural from the Cognitive with Agent-Based Modeling.”</span> <em>The Oxford Handbook of Cognitive Sociology</em>, 403.
</div>
<div id="ref-stopczynski2014measuring" class="csl-entry" role="listitem">
Stopczynski, Arkadiusz, Vedran Sekara, Piotr Sapiezynski, Andrea Cuttone, Mette My Madsen, Jakob Eg Larsen, and Sune Lehmann. 2014. <span>“Measuring Large-Scale Social Networks with High Resolution.”</span> <em>PloS One</em> 9 (4): e95978.
</div>
<div id="ref-watts1998collective" class="csl-entry" role="listitem">
Watts, Duncan, and Steven Strogatz. 1998. <span>“Collective Dynamics of ‘Small-World’networks.”</span> <em>Nature</em> 393 (6684): 440–42.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./26-complex-adaptive-systems.html" class="pagination-link" aria-label="Agent-based Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Agent-based Models</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./28-artificial-neural-networks-fnn-rnn-cnn.html" class="pagination-link" aria-label="Neural networks 101">
        <span class="nav-page-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Neural networks 101</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UWNETLAB/dcss_supplementary/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>