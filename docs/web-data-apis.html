<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Web data (APIs) ‚Äì Doing Computational Social Science&lt;br&gt;[The **Continuous Development** Edition]{.small}</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./web-data-scraping.html" rel="next">
<link href="./survey-data.html" rel="prev">
<link href="./figures/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="custom.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./survey-data.html"><strong>OBTAINING DATA</strong></a></li><li class="breadcrumb-item"><a href="./web-data-apis.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Web data (APIs)</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./figures/logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Doing Computational Social Science<br><span class="small">The <strong>Continuous Development</strong> Edition</span></a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/UWNETLAB/dcss_supplementary/tree/master/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
              <i class="bi bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
    </div>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">üè†</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>RESEARCH COMPUTING</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python-101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Python 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./python-102.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Python 102</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>THINKING THROUGH MODELS</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mindful-modelling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mindful modelling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./iterative-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Iterative workflows</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>OBTAINING DATA</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survey-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><del>Processing Structured Data</del> Survey Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-data-apis.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Web data (APIs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./web-data-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Web data (Scraping)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./audio-files-and-documents.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Audio files and documents</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>EXPLORING</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./exploratory-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Exploratory data analysis (EDA) <!-- Exploring with purpose --></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./association-and-latent-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Association and latent variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./text-as-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Text as Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mapping-text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Text similarity and latent semantic space</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./networks-as-not-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Networks and relational thinking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./centrality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Centrality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mapping-network-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Mapping network structure</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>PREDICTION &amp; INFERENCE</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./supervised-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Supervised Machine Learning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prediction-and-classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Prediction and classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./causality.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Causality</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Probability 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./credibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Credibility</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./measurement-and-missingness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Measurement and missingness</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>MODELING</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Bayesian Regression Models with Probabilistic Programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./multilevel-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Multilevel regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Generalized Linear Models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./structural-causal-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Structural causal models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modeling-texts-lda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Modeling text with LDA topic models</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modeling-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Latent structure in networks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./agent-based-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Agent-based models (ABMs)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./diffusion-opinion-cultural-cognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Diffusion, opinion dynamics, and cultural cognition</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>DEEP LEARNING</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./artificial-neural-networks-fnn-rnn-cnn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Artificial neural networks 101</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./language-models-and-embeddings.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Processing Natural Language Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./transformer-revolution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">The transformer revolution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./modeling-text-transformer-topic-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Modeling text: transformer topic models</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text"><strong>PROFESSIONAL RESPONSIBILITIES</strong></span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ethical-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Ethical CSS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./open-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Open CSS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./future-css.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Future CSS</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./courses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Courses and Workshops</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#application-programming-interfaces-apis" id="toc-application-programming-interfaces-apis" class="nav-link active" data-scroll-target="#application-programming-interfaces-apis"><span class="header-section-number">7.1</span> Application Programming Interfaces (APIs)</a>
  <ul class="collapse">
  <li><a href="#making-requests-with-python" id="toc-making-requests-with-python" class="nav-link" data-scroll-target="#making-requests-with-python"><span class="header-section-number">7.1.1</span> Making Requests with Python</a></li>
  <li><a href="#api-keys-tokens" id="toc-api-keys-tokens" class="nav-link" data-scroll-target="#api-keys-tokens"><span class="header-section-number">7.1.2</span> API Keys, Tokens</a></li>
  <li><a href="#responses" id="toc-responses" class="nav-link" data-scroll-target="#responses"><span class="header-section-number">7.1.3</span> Responses</a></li>
  </ul></li>
  <li><a href="#working-with-apis" id="toc-working-with-apis" class="nav-link" data-scroll-target="#working-with-apis"><span class="header-section-number">7.2</span> Working with APIs</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup"><span class="header-section-number">7.2.1</span> Setup</a></li>
  <li><a href="#the-guardian" id="toc-the-guardian" class="nav-link" data-scroll-target="#the-guardian"><span class="header-section-number">7.2.2</span> <em>The Guardian</em></a></li>
  <li><a href="#working-with-the-youtube-data-api" id="toc-working-with-the-youtube-data-api" class="nav-link" data-scroll-target="#working-with-the-youtube-data-api"><span class="header-section-number">7.2.3</span> Working with the YouTube Data API</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">7.3</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#key-points" id="toc-key-points" class="nav-link" data-scroll-target="#key-points"><span class="header-section-number">7.3.1</span> Key Points</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/UWNETLAB/dcss_supplementary/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./survey-data.html"><strong>OBTAINING DATA</strong></a></li><li class="breadcrumb-item"><a href="./web-data-apis.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Web data (APIs)</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Web data (APIs)</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Learning Objectives
</div>
</div>
<div class="callout-body-container callout-body">
<p>By the end of this chapter, you should be able to:</p>
<ul>
<li>Develop a mental model of what APIs are, how they work, and how they can be used for data collection.</li>
<li>Apply your understanding to work with specific APIs to collect the data you need.</li>
<li>Use Python programming to develop scripts that query APIs and programmatically collect and store data following best practices.</li>
<li>Work effectively with <em>The Guardian</em> REST API and the YouTube Data API.</li>
<li>Handle API authentication securely and efficiently.</li>
<li>Manage API rate limits and implement error handling.</li>
</ul>
</div>
</div>
<p><br></p>
<p>It‚Äôs time to put your Python programming skills to work by collecting data from the web! In this chapter, you‚Äôll learn how to collect data programmatically using web-based Application Programming Interfaces (APIs). You‚Äôll develop a solid understanding of what APIs are, how they function, and how to interact with them using Python. We‚Äôll work through practical examples using APIs from <strong>The Guardian</strong> and YouTube, which will prepare you to tackle other APIs in your research.</p>
<p>APIs provide some benefits to collecting data from the web. With rare exceptions, rules about what data we can collect and how we can collect it using APIs are explicitly stated, which removes some of the legal uncertainties that can complicate other data collection methods. Widely-used APIs are generally well-documented and maintained, and the data returned is usually well-structured and easy to work with.</p>
<p>It‚Äôs not <em>all</em> good, though. There are two main downsides to working with APIs: First, there may be restrictions on what data is provided, and if there are, those restrictions are often grounded in business interests rather than technical requirements and limitations. That said, the data that API providers <em>choose to include</em> is almost always complete because it is often generated programmatically as a byproduct of their platform, and applications depend on it. Second, APIs change, sometimes unexpectedly. Usually this is not a huge inconvenience, but it is possible to lose access to data without notice. The primary learning objective of this chapter is to understand how web-based APIs work in general and to develop a mental model that allows you to work with specific APIs to obtain the data you need. To that end, we will begin with a conceptual overview of what APIs are and how they work, which will include a pretty high-level discussion of how the Internet works. Then we will put that general knowledge to use by collecting data.</p>
<section id="application-programming-interfaces-apis" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="application-programming-interfaces-apis"><span class="header-section-number">7.1</span> Application Programming Interfaces (APIs)</h2>
<p>Understanding APIs starts with the notion of an <strong>interface</strong>‚Äîthe ‚ÄúI‚Äù in API. An interface allows different systems or components to communicate and interact with each other. In the context of software, an <strong>Application Programming Interface (API)</strong> is a set of rules and protocols that allows one piece of software to interact with another.</p>
<p>You‚Äôre already familiar with <strong>user interfaces</strong> (UIs)‚Äîthe buttons, menus, and controls you use to interact with software applications. UIs abstract the complexity of the underlying system, allowing you to perform tasks without needing to understand how they are implemented. Similarly, <strong>APIs</strong> allow software applications to interact with each other without exposing the internal complexities. They provide a set of predefined functions and protocols that developers can use to access the features or data of another application or service. In programming languages like Python, the functions and libraries you use are themselves APIs. They abstract low-level operations into high-level functions that are easier to use and understand. For example, when you use the <code>print()</code> function, you‚Äôre leveraging an API that handles the complexities of displaying output to the console.</p>
<p>When using web APIs for data collection, a bit of knowledge about the standardized protocols that devices use to communicate on the internet goes a long way.</p>
<ul>
<li><strong>IP Addresses and Domain Names</strong>: Every device on the internet has a unique IP address. We use human-readable domain names (e.g., nytimes.com) which are translated to IP addresses by DNS servers.</li>
<li><strong>HTTP and HTTPS</strong>: These protocols govern how data is transferred between clients (like your computer) and servers. They use methods like GET, POST, PUT, and DELETE to request or send data.</li>
<li><strong>REST APIs</strong>: These are interfaces that allow programs to interact with web services over HTTP/HTTPS. They abstract away many network complexities, letting you focus on data exchange.</li>
<li><strong>Client-Server Model</strong>: Your program (the client) sends requests to a server, which processes them and sends back responses.</li>
<li><strong>Data Packets</strong>: Information is broken into small packets for transmission, then reassembled at the destination.</li>
</ul>
<p>When you use an APIs for data collection, your program sends HTTP requests to specific URLs (endpoints) provided by the API. These requests include parameters that specify the data you want. The server then processes your request and sends back data, typically in formats like JSON or XML. You store that data locally (to avoid making redundant API calls), and then process it for analysis.</p>
<section id="making-requests-with-python" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="making-requests-with-python"><span class="header-section-number">7.1.1</span> Making Requests with Python</h3>
<p>We have just learned, at a relatively high-level, what happens when your computer (<strong>the ‚Äúclient‚Äù</strong>) makes a request for a webpage (<strong>the ‚Äúresource‚Äù</strong>) from a server. In a similar fashion, you can write programs that make <code>GET</code> requests for resources from a server. These resources can be just about anything, but as researchers, we usually want to retrieve some sort of data or metadata from a web server. To do so, we send our requests to a specific ‚Äúendpoint.‚Äù</p>
<p>An <strong>endpoint</strong> is a location on the Internet where you send a request for a specific resource. Recall that ‚Äúresource‚Äù is an abstract term for just about anything that we want to retrieve from a web server. If you are working with a Twitter API, for example, you will see that there are endpoints for requesting data about tweets and an endpoint for requesting data about users. If you are working with the API for <em>The Guardian</em> or another news organization, you will see that there is an endpoint for ‚Äúcontent,‚Äù among other things. To access the resources we want, we have to send our request to the correct endpoint. In nearly all cases, this will be in the form of a URL.</p>
<p>The URLs that we use to send requests to endpoints typically include several important pieces of information that enable us to specify what we want the API to return. For example, the URL may include information about our <strong>query</strong>, as well as some optional <strong>parameters</strong> and <strong>filters</strong>. Usually, this information is combined into a single URL.</p>
<p>If web servers receive too many requests at once ‚Äì whether intentionally, in the form of a coordinated attack, or unintentionally, in the form of a poorly written or inconsiderate script ‚Äì they can be overwhelmed. To prevent this from happening, most APIs use <strong>rate limiting</strong> to restrict the number of requests that a user can make within specific time frames. Ss of June 2020, <em>The Guardian</em> content endpoint limits users to making 12 requests per second and a maximum of 5,000 calls per day. Other APIs will have their own restrictions, which you can learn about in the API <strong>Terms of Service</strong>. Most of the time, APIs enforce rate limits by detecting overuse and then disconnecting or throttling users, while others use an honour system but heavily penalize users who are found to be violating those limits, such as blacklisting the user.</p>
</section>
<section id="api-keys-tokens" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="api-keys-tokens"><span class="header-section-number">7.1.2</span> API Keys, Tokens</h3>
<p>To make requests to an API you will usually need an <strong>API Key</strong>, or <strong>API Token</strong>. You can think of these as a username and password that identify you to the API. Unlike usernames and passwords, you don‚Äôt set them yourself. Instead, the API provides them to you when you sign up for their service and agree to their Terms of Service. We will see several examples of obtaining and working with different API tokens in the examples that follow.</p>
<p>It is <em>crucial</em> that you do not share your API tokens. Do <strong>not</strong> write them directly into your scripts, or inadvertently commit them to a public repository (e.g., on GitLab or GitHub). Doing so is comparable to sharing usernames and passwords you use for any other web service and any misuse will be tied to you as the user. If someone obtained your API keys for <em>The Guardian</em>, they could access the service as if they were you, and you will suffer the consequences. If you believe your access token has been compromised for some reason, find an appropriate point of contact and inform them. They have an interest in ensuring that <em>no one</em> is using compromised tokens. Later in the chapter, we will learn how to use your keys while maintaining a high level of security.</p>
</section>
<section id="responses" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="responses"><span class="header-section-number">7.1.3</span> Responses</h3>
<p>When we make a <code>GET</code> request to an API, we get a <strong>response</strong> in return. These responses have numerical codes, such as the familiar <code>404</code> (Page Not Found) error you get when you follow a dead link. There are many possible response codes, most of which you don‚Äôt see when you‚Äôre just browsing the web. For example, if your request was successful, you will get a <code>200</code> (OK) response code. On the other hand, if there was some sort of problem with your request, you will likely get a response code such as <code>401</code> (unauthorized), <code>403</code> (forbidden), <code>500</code> (internal server error), or <code>503</code> (the server is unavailable). When you are developing scripts to programmatically collect data from APIs, it is always a good idea to check the status of any given request. Because there are many possible responses for errors, it is better to check for success (i.e.&nbsp;<code>200</code>) than failure.</p>
<p>Technically, web-based APIs can return anything, but by far the most common way of providing data is <strong><code>json</code></strong>, which stands for JavaScript Object Notation. <code>json</code> is a nested data structure that looks a lot like a Python <code>dictionary</code> in that the data is stored using key-value pairs inside curly braces. For this reason, working with <code>json</code> is relatively painless in Python. If you import the standard library <code>json</code>, you can easily read and write <code>json</code> files, and when loaded in memory you can use dictionary methods to work with that data. Additionally, it is possible to use the <code>Pandas</code> package (discussed in later chapters) to read <code>json</code> directly into a <code>dataframe</code> using the <code>.read_json()</code> method. We will see many examples of working with <code>json</code> throughout the rest of this chapter.</p>
</section>
</section>
<section id="working-with-apis" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="working-with-apis"><span class="header-section-number">7.2</span> Working with APIs</h2>
<p>Now that we have a conceptual understanding of what APIs are and how they work in general, we can get a bit more practical. In the rest of this chapter, we make these abstract concepts more concrete by comparing several practical examples of collecting data programmatically via web-based APIs. Remember, these examples are not intended to be comprehensive recipes for working with specific APIs. Instead, the idea is that you will deepen your <em>general</em> understanding of APIs by comparing multiple examples. When doing your own research, you will likely want to use some feature of an API that I haven‚Äôt covered, but you will have the foundational knowledge and understanding required to understand the documentation and solve the problem yourself.</p>
<section id="setup" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="setup"><span class="header-section-number">7.2.1</span> Setup</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dcss.youtube <span class="im">as</span> yt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dcss.cleaners <span class="im">as</span> clean</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dcss.utils <span class="im">as</span> utils</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="the-guardian" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="the-guardian"><span class="header-section-number">7.2.2</span> <em>The Guardian</em></h3>
<p>Many major newspapers provide access to non-trivial amounts of data on their published articles via APIs and <em>The Guardian</em> is no exception. As of January 2021, it offers five endpoints:</p>
<ol type="1">
<li>The <strong>content endpoint</strong> provides the text and metadata for published articles. It is possible to query and filter results. This endpoint is likely the most useful for researchers.</li>
<li>The <strong>tags endpoint</strong> provides API tags for greater than 50,000 results, which can be used in other API queries.</li>
<li>The <strong>sections endpoint</strong> provides information on groupings of published articles into sections.</li>
<li>The <strong>editions endpoint</strong> provides content for the each of regional main pages: US, UK, Australia, and International.</li>
<li>The <strong>single items endpoint</strong> returns data for specific items, including content, tags, and sections.</li>
</ol>
<p>Often, the easiest way to work with an API is to use a ‚Äúclient.‚Äù Python clients for <em>The Guardian</em> API or other APIs are no different than any other Python package: they provide functions that abstract away some of the complexities of authenticating with, making requests to, and processing results from the API. You may want to use clients from time to time, such as when working with large and relatively complex APIs. Here, however, we will work directly with <em>The Guardian</em> API using a package called <code>requests</code>. This affords a bit more flexibility and freedom in how we interface with the API, and will help make some of the previously introduced concepts more concrete.</p>
<section id="accessing-the-guardian-api" class="level5" data-number="7.2.2.0.1">
<h5 data-number="7.2.2.0.1" class="anchored" data-anchor-id="accessing-the-guardian-api"><span class="header-section-number">7.2.2.0.1</span> Accessing <em>The Guardian</em> API</h5>
<p>As with most other APIs, you need to register for an API key to access <em>The Guardian</em> API. This key enables them to monitor your access to their data and ensure you are following their terms of service. Once you have your API key, you can make 12 calls per second and up to 5,000 calls per day. You can access the article text (but not images, audio, or video) for millions of articles for free. As with many other APIs, it‚Äôs possible to unlock more content by paying for a commercial license.</p>
<p>You can obtain your API keys by registering on <em>The Guardian</em>‚Äôs website. The process is outlined on their <a href="open-platform.theguardian.com/documentation/">developer page</a>. We won‚Äôt review all the steps here, as they can easily change and result in confusion. However, the process is straightforward and well-explained.</p>
<p>In this case, your API key will be a single alphanumeric string. To store and use this key securely, open a new text file with the following one liner:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>GUARDIAN_KEY <span class="op">=</span> <span class="st">'paste_your_key_here'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Save this file with the name <code>.env</code> and store it in the same directory as whatever notebook or script will contain the code you write to query the API. If you are using git for version control, don‚Äôt forget to add <code>.env</code> to your <code>.gitignore</code> file. Once you have saved <code>.env</code>, you can load your keys into your script and authenticate with the API.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>KEY_NAMES <span class="op">=</span> [<span class="st">'GUARDIAN_KEY'</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>API_KEYS <span class="op">=</span> utils.load_api_key_list(KEY_NAMES)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>GUARDIAN_KEY <span class="op">=</span> API_KEYS[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We are now ready to make requests to the API.</p>
</section>
<section id="making-requests" class="level5" data-number="7.2.2.0.2">
<h5 data-number="7.2.2.0.2" class="anchored" data-anchor-id="making-requests"><span class="header-section-number">7.2.2.0.2</span> Making Requests</h5>
<p>We‚Äôll use a package called <code>requests</code> to make our API requests. Once the package has been imported, we can do this by providing the <code>.get()</code> method with the base <strong>API url</strong> for the <a href="https://open-platform.theguardian.com/documentation/search">content endpoint</a>. We will also create a dictionary called <code>PARAMS</code>, which will contain a key-value pair for our API key. Later, we will add more key-value pairs to this dictionary to change what the API returns.</p>
<p>The actual call to the API is made in line 7 of the code block below, where <code>requests</code> authenticates us with <em>The Guardian</em>‚Äôs servers by sending a <code>GET</code> request to the API with our API key. The API returns a response, including some <code>json</code> data that we store in the variable <code>response_dict</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>API_ENDPOINT <span class="op">=</span> <span class="st">'http://content.guardianapis.com/search'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>PARAMS <span class="op">=</span> {<span class="st">'api-key'</span>: GUARDIAN_KEY}</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(API_ENDPOINT, params<span class="op">=</span>PARAMS)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>response_dict <span class="op">=</span> response.json()[<span class="st">'response'</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">len</span>(response_dict))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you print the <code>response_dict</code>, you will see there is quite a lot of information included here and we haven‚Äôt even provided any specific search criteria! Why is that?</p>
<p>By default, <em>The Guardian</em> is returning a sample of current news stories. Let‚Äôs start by digging into the fields contained in this response. Remember, since <code>json</code> is essentially identical to a Python dictionary, it‚Äôs natural to store it as a dictionary. We can get a list of the available fields by using the <code>.keys()</code> method.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response_dict.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The most useful data is contained in the <code>results</code> field, which you can access with <code>response_dict['results']</code>. This is where the actual article context is stored.</p>
<p>If you look at the contents of <code>response_dict['results']</code>, you will find a list of 10 dictionaries, each corresponding to one of the 10 retrieved stories, which is the default number of stories returned. Each story has several key value pairs containing useful article metadata such as an ID, a type, section IDs, publication date, the title, the URL for the story and for further API access, and so on. The actual content of the publications is not included, though; we will learn how to retrieve it shortly.</p>
</section>
<section id="filtering-results" class="level5" data-number="7.2.2.0.3">
<h5 data-number="7.2.2.0.3" class="anchored" data-anchor-id="filtering-results"><span class="header-section-number">7.2.2.0.3</span> Filtering Results</h5>
<p>Earlier, I mentioned that we can use queries and filters to retrieve specific types of content from an API. You can use queries to find content just as you would if you were using a search engine and you can use filters to narrow the returned content on the basis of specific metadata. The API documentation provides information on what kinds of filters are available. For example, in the code block below, we can use filters to specify:</p>
<ul>
<li>a specific date or range of dates when the articles were last published</li>
<li>the language</li>
<li>the production office</li>
<li>a term to search for</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>PARAMS <span class="op">=</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'api-key'</span>: GUARDIAN_KEY,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'from-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'to-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lang'</span>: <span class="st">'en'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'production-office'</span>: <span class="st">'uk'</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'q'</span>: <span class="st">'coronavirus'</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(API_ENDPOINT, params<span class="op">=</span>PARAMS)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>response_dict <span class="op">=</span> response.json()[<span class="st">'response'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notice that the resulting <code>response_dict</code> contains more information than our last set of results.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(response_dict.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There are several new fields here, but still no article content or bylines. To retrieve this and other data, we can specify it using the <code>show-fields</code> parameter. Let‚Äôs add it to our search.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>PARAMS <span class="op">=</span> {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'api-key'</span>: GUARDIAN_KEY,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'from-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'to-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lang'</span>: <span class="st">'en'</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'production-office'</span>: <span class="st">'uk'</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'q'</span>: <span class="st">'coronavirus'</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'show-fields'</span>: <span class="st">'wordcount,body,byline'</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(API_ENDPOINT, params<span class="op">=</span>PARAMS)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>response_dict <span class="op">=</span> response.json()[<span class="st">'response'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now, when you print the content of <code>response_dict</code>, you will see we have the additional data we were looking for. I won‚Äôt print all of that here, but you can by executing the following code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> response <span class="kw">in</span> response_dict[<span class="st">'results'</span>]:</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(response[<span class="st">'fields'</span>][<span class="st">'body'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that the text itself contains HTML tags ‚Äì we will discuss these in the next chapter.</p>
</section>
<section id="asking-for-more-data" class="level5" data-number="7.2.2.0.4">
<h5 data-number="7.2.2.0.4" class="anchored" data-anchor-id="asking-for-more-data"><span class="header-section-number">7.2.2.0.4</span> Asking for More Data</h5>
<p>We‚Äôve now seen how to get useful data from article publications that meet our search criteria, but we still only have that data for 10 stories. To get more, we need to dig into some additional API concepts. Three of the keys of our <code>response_dict</code> describe the volume of data we receive: <code>total</code>, <code>pages</code>, and <code>pageSize</code>. They all work together, in a fashion similar to the results that would be returned by a search engine. <code>Total</code> is a count of the total number of stories available. These results can be broken up into multiple <code>pages</code>, again, like results returned from a search engine. The number of stories included in any given page is determined by the <code>pageSize</code>. If we want the API to return all available stories, we need to change these parameters when we make our request. We can do this by specifying how many stories should be returned in a single page, and then request stories from multiple pages, much as we might click to navigate to the second, third, <em>n</em>th page of results in a search.</p>
<p>Below, we update our search parameters with a new parameter specifying <code>pageSize</code>. We will increase it from 10 to 50.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>PARAMS <span class="op">=</span> {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'api-key'</span>: GUARDIAN_KEY,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'from-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'to-date'</span>: <span class="st">'2020-04-10'</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'lang'</span>: <span class="st">'en'</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'production-office'</span>: <span class="st">'uk'</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'q'</span>: <span class="st">'coronavirus'</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'show-fields'</span>: <span class="st">'wordcount,body,byline'</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'page-size'</span>: <span class="dv">50</span>,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(API_ENDPOINT, params<span class="op">=</span>PARAMS)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>response_dict <span class="op">=</span> response.json()[<span class="st">'response'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Increasing the number of stories on any given page is not actually necessary to obtain all of the data we want, since we can simply request more pages. However, we have to make a new API request for each page, which increases the load on <em>The Guardian</em> servers. Instead, we reduce the number of calls we need to make by increasing the amount of data returned in each individual call. You could probably get away with increasing this number, but there are a couple good reasons why you might want to keep it at a modest setting. First, many APIs have rate limits or maximum thresholds above which they‚Äôll refuse to return any data; haphazardly increasing the amount of data you ask for in a single request might run you afowl of these limits. Second, it‚Äôs simply more considerate! Other people and organizations are likely trying to use the same API, and the API itself only has so much bandwidth (both literally and figuratively); just because you can push the limits doesn‚Äôt mean you should. Exercising temperence is part of being a good digital citizen.</p>
<p>To iterate through each page of results, we will use yet another parameter: <code>page</code>. However, unlike before, we will update this parameter dynamically, enabling us to make new requests for each page of available data until we have collected all results.</p>
<p>The dict <code>PARAMS</code> has been written and re-written several times now, but the most recent version contains our fully developed search, including the increased number of stories on each page. We will execute this search multiple times, each time retrieving data for a new page. Because we want to use the <code>page</code> parameter and to update it dynamically, we will use a while loop.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>all_results <span class="op">=</span> []</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>cur_page <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>total_pages <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (cur_page <span class="op">&lt;=</span> total_pages) <span class="kw">and</span> (cur_page <span class="op">&lt;</span> <span class="dv">10</span>):  <span class="co"># with a fail safe</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make a API request</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    PARAMS[<span class="st">'page'</span>] <span class="op">=</span> cur_page</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(API_ENDPOINT, params<span class="op">=</span>PARAMS)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    response_dict <span class="op">=</span> response.json()[<span class="st">'response'</span>]</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update our master results list</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    all_results <span class="op">+=</span> (response_dict[<span class="st">'results'</span>])</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update our loop variables</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    total_pages <span class="op">=</span> response_dict[<span class="st">'pages'</span>]</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    cur_page <span class="op">+=</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(all_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>Don‚Äôt forget</em>, we need to be very careful about rate limiting when we automate our API requests like this, to be mindful of <em>The Guardian</em> servers, and to prevent losing access. To ensure that you‚Äôre not over-taxing the API, consider adding in <code>time.sleep()</code> calls, which will have the effect of spacing out your requests. During testing, it‚Äôs also a good idea to keep your requests to an absolute minimum.</p>
</section>
<section id="storing-your-data" class="level5" data-number="7.2.2.0.5">
<h5 data-number="7.2.2.0.5" class="anchored" data-anchor-id="storing-your-data"><span class="header-section-number">7.2.2.0.5</span> Storing Your Data</h5>
<p>At this point, we have learned how to use use the <code>requests</code> package and our API key to make <code>GET</code> requests to <em>The Guardian</em>‚Äôs API, and how to use parameters to query and filter results returned from the content endpoint. We also learned that the data we want is split up into multiple ‚Äúpages‚Äù of results, and to retrieve everything, we have to make individual requests for each page. In doing so, we need to adopt an approach to automating API requests that ensures we stay within the rate limits and don‚Äôt violate any other terms of service.</p>
<p>Now that we have our data, we need to write it to disk so that it is easily accessed, now or later, without making redundant calls to the API. This will also enable us to decouple the code used to collect this data from any code we develop to clean and analyze it. Remember, that kind of code separation is considered best practice <em>in general</em>, and is a key component of specific computational research workflows, such as the principled data processing framework.</p>
<p>We can use the <code>json</code> module to write this data to disk using the <code>with open(x) as</code> approach.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>FILE_PATH <span class="op">=</span> <span class="st">'data/guardian_api_results.json'</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(FILE_PATH, <span class="st">'w'</span>) <span class="im">as</span> outfile:</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    json.dump(all_results, outfile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we have a firm grasp on how to query data from <em>The Guardian</em>‚Äôs relatively simple REST API, you‚Äôre ready to move onto a more powerful and complex APIs.</p>
</section>
</section>
<section id="working-with-the-youtube-data-api" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="working-with-the-youtube-data-api"><span class="header-section-number">7.2.3</span> Working with the YouTube Data API</h3>
<p>The YouTube API is well-documented, but it can be a challenging API to start with. The YouTube module in <code>dcss</code> will make things a little easier. If you are comfortable with the content I present here and want to learn more, I would encourage you to review the code I wrote for the package the <code>dcss</code> package.</p>
<section id="get-a-youtube-api-key" class="level4" data-number="7.2.3.1">
<h4 data-number="7.2.3.1" class="anchored" data-anchor-id="get-a-youtube-api-key"><span class="header-section-number">7.2.3.1</span> Get a YouTube API Key</h4>
<p>The first thing you need to do is get yourself an API key. You can do that by following these steps, each described in more detail below.</p>
<ol type="1">
<li>Log into / sign up for a Google Account</li>
<li>Go to the Google Cloud Console website</li>
<li>Create a new project</li>
<li>Enable the <strong>YouTube Data API v3</strong></li>
<li>Create an API key for the YouTube Data API v3</li>
<li>Store Your API Key Securely</li>
<li>Restrict your API key</li>
</ol>
<p><strong>(1)</strong> First, you‚Äôll need to sign up for a Google account if you don‚Äôt already have one. <strong>(2)</strong> Next, open the <a href="https://console.cloud.google.com/">Google Cloud Console</a> webpage. You should see something like this:</p>
<p><img src="images/google-cloud-console.png" class="img-fluid"></p>
<p><strong>(3)</strong> Use the dropdown menu to the right of <strong>Google Cloud</strong> to create a <strong>New Project</strong>. If you already have a project setup, it may show the name of the current project. In my case, it shows <code>INTRO-CSS</code>. Give your project an informative name and leave the location field as is. Press <strong>Create</strong>.</p>
<p><img src="images/new-project.png" class="img-fluid"></p>
<p><strong>(4)</strong> Next, you‚Äôll need to enable the YouTube Data API v3. Under ‚ÄúQuick Access‚Äù, click on <strong>APIs &amp; Services</strong> and select <strong>Library</strong>. Type <strong>YouTube</strong> into the search bar and then select <strong>YouTube Data API v3</strong>. A new page will load with ‚Äú1 result‚Äù. Click the button and then enable the YouTube API on the new page.</p>
<p><img src="images/enable_api.png" class="img-fluid"></p>
<p><strong>(5)</strong> Now you can create an API key for the YouTube Data API v3. Select <strong>Credentials</strong> from the left-side navigation pane. When the page loads, click the <strong>Create Credentials</strong> button and select <strong>API Key</strong>.</p>
<p><img src="images/create_credentials.png" class="img-fluid"></p>
<p>You should see a popup that looks something like this:</p>
<p><img src="images/api_key.png" class="img-fluid"></p>
<p><strong>(6)</strong> Your API key is like a password; you should treat it as such. Copy your key, store it someplace secure,<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, and then close the popup. You should see your new key listed under <strong>API Keys</strong> with an orange alert icon to the right of your key name. In my case, the newly created key is <code>API key 2</code>.</p>
<p><img src="images/listed_keys.png" class="img-fluid"></p>
<p><strong>(7)</strong> Finally, you‚Äôll want to restrict your API Key. Click the three dots under <code>Actions</code> to <code>Edit API Key</code>. You should see something like this:</p>
<p><img src="images/edit_keys.png" class="img-fluid"></p>
<p>Under <code>API Restrictions</code>, select <code>Restrict key</code> and then select <code>YouTube Data API v3</code> from the drop-down menu. Click <code>Save</code>.</p>
<p><img src="images/restrict_key.png" class="img-fluid"></p>
<p>Your API key is now ready to use!</p>
</section>
<section id="using-your-api-key-securely" class="level4" data-number="7.2.3.2">
<h4 data-number="7.2.3.2" class="anchored" data-anchor-id="using-your-api-key-securely"><span class="header-section-number">7.2.3.2</span> Using Your API Key Securely</h4>
<p>Let‚Äôs add our API key(s) to the <code>.env</code> file created earlier. Remember that each line of the file should contain the name and the value of your API key (so just 1 line if you are using 1 API key). The name itself doesn‚Äôt matter, but it‚Äôs useful to give it a name that corresponds to the name of the project you created to get the API key. The example below is a randomly-generated fake API key assigned to the name GESIS.</p>
<pre><code>GESIS='GEzaLyB69Xh5yz3QRsdP-X8QeLMpgWuva-XmWKh'</code></pre>
<p>If you have more than one API key (which can come in handy), make sure each key is on its own line. We can then load our API key(s) using the same process we did before.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>KEY_NAMES <span class="op">=</span> [<span class="st">"GESIS"</span>, <span class="st">"GESISPY"</span>, <span class="st">"INTRO_CSS"</span>, <span class="st">"INTROCSS2024"</span>, <span class="st">"YouTubeAPILecture"</span>, <span class="st">"metascience_golems"</span>, <span class="st">"McLevey"</span>, <span class="st">"MSGD"</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>API_KEYS <span class="op">=</span> utils.load_api_key_list(KEY_NAMES)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>YOUTUBE_API <span class="op">=</span> yt.YouTubeAPI(API_KEYS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="understanding-the-youtubeapi-class" class="level4" data-number="7.2.3.3">
<h4 data-number="7.2.3.3" class="anchored" data-anchor-id="understanding-the-youtubeapi-class"><span class="header-section-number">7.2.3.3</span> Understanding the YouTubeAPI Class</h4>
<p>The YouTubeAPI class is designed to handle interactions with the YouTube API, specifically error handling and the task of using multiple API keys at once and an exponential back-off strategy to avoid rate limiting and handle errors automatically.</p>
<p>As you can see in the code block above, we initialize the YouTubeAPI class with a list of API keys. If you use the <code>load_api_key_list()</code> function and a config file, this is a simple process. Once you initialize it, the class:</p>
<ul>
<li><strong>Creates a ‚Äúservice‚Äù object</strong>, which is the main interface to the YouTube API and allows us to send requests and receive responses. It does this using the googleapiclient.discovery.build() function and the build_service() method.</li>
<li><strong>Automatically switches API keys</strong> if one API key hits a rate limit.</li>
<li><strong>Executes requests</strong> using an execute_request() method. This method handles the actual sending of requests to the API and includes error handling to manage rate limits and retries. It also uses an exponential backoff strategy to avoid overwhelming the API with too many requests in a short time.</li>
</ul>
</section>
<section id="get-the-youtube-channel-ids" class="level4" data-number="7.2.3.4">
<h4 data-number="7.2.3.4" class="anchored" data-anchor-id="get-the-youtube-channel-ids"><span class="header-section-number">7.2.3.4</span> Get the YouTube Channel IDs</h4>
<p>In this example, we‚Äôre going to collect data from the talksatgoogle YouTube channel. To do that, we need to start by getting its YouTube channel ID. We can do this using the <code>get_channel_id()</code> function from the icsspy course package. This function is robust in handling different ways users might identify YouTube channels, making it easier to work with the API.</p>
<p><code>get_channel_id()</code> tries two methods to find the channel‚Äôs ID:</p>
<ol type="1">
<li>Custom URL Search: It first checks if the provided channel argument is a custom URL. Many YouTube channels use custom URLs for easier access.</li>
<li>Username Search: If the custom URL search fails, it then tries to get the channel ID using the YouTube username.</li>
</ol>
<p>If both methods fail, the function returns None.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>channel <span class="op">=</span> <span class="st">'talksatgoogle'</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>channel_id <span class="op">=</span> yt.get_channel_id(YOUTUBE_API, channel)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'The YouTube Channel ID for </span><span class="sc">{</span>channel<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>channel_id<span class="sc">}</span><span class="ss">.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="use-the-channel-id-to-collect-video-data" class="level4" data-number="7.2.3.5">
<h4 data-number="7.2.3.5" class="anchored" data-anchor-id="use-the-channel-id-to-collect-video-data"><span class="header-section-number">7.2.3.5</span> Use the Channel ID to Collect Video Data</h4>
<p>With the channel ID in hand, we can retrieve a list of video IDs associated with the channel using the get_channel_video_ids() function, which sends a request to the YouTube API to get the channel‚Äôs uploads playlist ID and then iteratively fetches all the channel‚Äôs public video IDs.</p>
<p>We can pass the resulting lists of video IDs to the get_channel_video_data() function, which makes another API query to collect data such as the video‚Äôs title, description, statistics (like views and likes), and other metadata.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>video_ids <span class="op">=</span> yt.get_channel_video_ids(YOUTUBE_API, channel_id)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>video_details <span class="op">=</span> yt.get_channel_video_data(YOUTUBE_API, video_ids)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Collected data on </span><span class="sc">{</span><span class="bu">len</span>(video_details)<span class="sc">}</span><span class="ss"> videos from </span><span class="sc">{</span>channel<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>utils.save_json(video_details, <span class="st">'data/videos.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Like most modern APIs, the YouTube API returns data in JSON format. We‚Äôll store this data by writing the JSON to disk, which will allow us to easily reload the data later without needing to re-query the YouTube API. For example, we can load the JSON data ‚Äì from disk or memory ‚Äì directly into a Pandas dataframe.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>videos <span class="op">=</span> pd.json_normalize(video_details)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>videos.to_csv(<span class="st">'data/videos.csv'</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>videos.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we have data on {python} len(video_details) videos, let‚Äôs query the YouTube API to collect data on the comments on these videos.</p>
</section>
<section id="process-channel-data-and-prepare-to-collect-video-comments" class="level4" data-number="7.2.3.6">
<h4 data-number="7.2.3.6" class="anchored" data-anchor-id="process-channel-data-and-prepare-to-collect-video-comments"><span class="header-section-number">7.2.3.6</span> Process Channel Data and Prepare to Collect Video Comments</h4>
<p>You‚Äôll likely end up running the code in this notebook several times (or more). Each time you‚Äôll query the YouTube API, potentially re-collecting data you‚Äôve already collected. Since collecting comments can involve a very large number of API calls, and API calls are expensive in terms of quota, we‚Äôll do some prep work to minimize our API calls and the risk of hitting the rate limit.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>videos[<span class="st">"statistics.commentCount"</span>] <span class="op">=</span> pd.to_numeric(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  videos[<span class="st">"statistics.commentCount"</span>], errors<span class="op">=</span><span class="st">'coerce'</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>probably_no_public_comments <span class="op">=</span> videos[videos[<span class="st">"statistics.commentCount"</span>].isna()][<span class="st">"id"</span>].tolist()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>no_public_comments <span class="op">=</span> videos[videos[<span class="st">"statistics.commentCount"</span>] <span class="op">==</span> <span class="dv">0</span>][<span class="st">"id"</span>].tolist()</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>has_public_comments <span class="op">=</span> videos[videos[<span class="st">"statistics.commentCount"</span>] <span class="op">&gt;</span> <span class="dv">0</span>][<span class="st">"id"</span>].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We‚Äôll check for the file data/talks_at_google_video_comments.csv, which is created a little later in this tutorial; if it already exists, we‚Äôll get the IDs for videos we‚Äôve already downloaded and skip their collection. If the file hasn‚Äôt been created yet (i.e., this is the first time you‚Äôre running this code), then it will collect everything.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>no_redownloading <span class="op">=</span> <span class="va">True</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> no_redownloading <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        already_downloaded <span class="op">=</span> pd.read_csv(<span class="st">"data/comments.csv"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        already_downloaded <span class="op">=</span> already_downloaded[<span class="st">"video_id"</span>].unique().tolist()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>        has_public_comments <span class="op">=</span> [</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            video</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> video <span class="kw">in</span> has_public_comments</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> video <span class="kw">not</span> <span class="kw">in</span> <span class="bu">set</span>(already_downloaded)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> (<span class="pp">FileNotFoundError</span>, pd.errors.EmptyDataError):</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        already_downloaded <span class="op">=</span> []</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We‚Äôll also skip the videos in ‚Äúprobably_no_public_comments,‚Äù but if you want to try collecting them, just uncomment the second line below.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>collect <span class="op">=</span> has_public_comments</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># collect = has_public_comments + probably_no_public_comments</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set this to true the first time you run it; then false</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>overwrite <span class="op">=</span> <span class="va">True</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># overwrite = False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With this prep work done, we can collect comment data using the collect_comments_for_videos() function, which iterates over a list of video IDs and collects comments for each video. It starts by opening a CSV file to store the comments. If overwrite is True (see the code block above), it will create a new file; otherwise, it appends to an existing file. For each video, it calls the get_video_comments() function, which fetches the comments using the YouTube API. The comments are then written to the CSV file in real-time.</p>
<p>collect_comments_for_videos() includes error handling for cases where comments might be disabled or where rate limits are exceeded, which means the function can handle issues that come up without crashing. This makes it useful for collecting large amounts of data.</p>
<p>There are a lot of comments to collect, so this code will take a while to run. There‚Äôs a progress bar to let you know what to expect. Once it‚Äôs up and running, you‚Äôll want to leave it for a bit and come back.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>all_comments <span class="op">=</span> yt.collect_comments_for_videos(</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    YOUTUBE_API, collect, <span class="st">"data/comments.csv"</span>, overwrite<span class="op">=</span>overwrite</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, after collecting the comments, we can load them into a dataframe and take a look. We‚Äôll also write the data a local file so we can re-load and analyze it later.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>all_comments <span class="op">=</span> pd.read_csv(<span class="st">'data/comments.csv'</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>all_comments.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>all_comments.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="conclusion" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">7.3</span> Conclusion</h2>
<p>In this chapter, you learned how to collect data programmatically from web-based APIs. You developed a mental model of how APIs work, including authentication, making requests, handling responses, and managing rate limits.</p>
<p>By working with <strong>The Guardian</strong> API and the YouTube Data API, you gained hands-on experience in:</p>
<ul>
<li><strong>Authenticating and Making Requests</strong>: Using API keys and the <code>requests</code> library to interact with APIs.</li>
<li><strong>Filtering and Paginating Results</strong>: Using parameters and loops to retrieve all relevant data.</li>
<li><strong>Handling JSON Data</strong>: Parsing JSON responses and storing data in Python data structures.</li>
<li><strong>Storing Data</strong>: Saving data to JSON and CSV files for later analysis.</li>
<li><strong>Error Handling and Rate Limiting</strong>: Implementing strategies to handle API limitations gracefully.</li>
</ul>
<p>APIs are powerful tools for data collection in computational social science. They provide structured and accessible data, enabling you to perform various analyses. However, it‚Äôs important to use them responsibly, adhering to terms of service and ethical considerations.</p>
<hr>
<section id="key-points" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="key-points"><span class="header-section-number">7.3.1</span> Key Points</h3>
<ul>
<li><strong>APIs Simplify Data Access</strong>: APIs abstract away the complexities of interacting with web services, providing a simple interface for data access.</li>
<li><strong>Understanding RESTful APIs</strong>: REST APIs use standard HTTP methods and are stateless, resource-based interfaces.</li>
<li><strong>Secure API Authentication</strong>: Always protect your API keys and tokens by storing them securely and not exposing them in your code.</li>
<li><strong>Making Efficient Requests</strong>: Use parameters and filters to retrieve only the data you need, and handle pagination to access large datasets.</li>
<li><strong>Handling Responses and Errors</strong>: Check status codes, parse JSON data, and implement error handling to create robust data collection scripts.</li>
<li><strong>Managing Rate Limits</strong>: Be mindful of API rate limits and implement strategies like exponential backoff and API key rotation.</li>
<li><strong>Data Storage Best Practices</strong>: Save collected data to files to avoid redundant API calls and to facilitate data analysis.</li>
</ul>
<p>In the next chapter, we‚Äôll explore web scraping, another method for collecting data from the web when APIs are unavailable or insufficient for your research needs. You‚Äôll learn how to extract data from web pages using tools like <code>BeautifulSoup</code> and handle challenges like navigating HTML structures and handling dynamic content.</p>
<hr>


</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>I recommend using <a href="https://bitwarden.com">Bitwarden</a> or another password manager.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./survey-data.html" class="pagination-link" aria-label="~~Processing Structured Data~~ Survey Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title"><del>Processing Structured Data</del> Survey Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./web-data-scraping.html" class="pagination-link" aria-label="Web data (Scraping)">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Web data (Scraping)</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UWNETLAB/dcss_supplementary/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>